(function(){function l(a){if("debug"==config.readerMode){var b=window.open("_blank");b.document.write(a.responseText)}}function m(){if(!a.prop("checked"))return a.parent().addClass("alert"),!1;var b=addrContainer.find("form");if(b.length>0){var c=addrContainer.children(".flash-alert");return 0==c.length&&(c=$('<div class="flash-alert">').insertBefore(b)),c.append("<p>Tu dois valider ton adresse d'abord</p>"),!1}return!0}function n(){a=$("#accept-cgv"),cgv=$("#cgv_dialog"),addrContainer=$("#order-adresse"),c=$("#askModifyAddress"),d=$("#sendModifyAddress"),e=$("#sendCreateAddress"),f=$("#paypal_submit"),h=$("#payzenBuyForm"),i=$("#payzen_submit"),j=$("#checkout"),k=$("#order-detail .remove_product"),k.click(s),addrContainer.on("click","#askModifyAddress",q),addrContainer.on("submit","form",function(a){1==$(this).find("#sendCreateAddress").length?p.call(this,a):1==$(this).find("#sendModifyAddress").length&&r.call(this,a)}),a.change(function(){a.prop("checked")?a.parent().removeClass("alert"):a.parent().addClass("alert")}),$("#show_cgv").click(function(){$.ajax({url:config.publicRoot+"achat/order/CGV",type:"GET",success:function(a){cgv.children(".sep_line").nextAll().remove(),cgv.children(".sep_line").after(a),cgv.addClass("show")}})}),window.PAYPAL&&(dg=new PAYPAL.apps.DGFlow({expType:"instant"})),j.click(function(b){if(!a.prop("checked"))return a.parent().addClass("alert"),b.preventDefault(),void 0;var c=addrContainer.find("form");if(c.length>0){var d=addrContainer.children(".flash-alert");return 0==d.length&&(d=$('<div class="flash-alert">').insertBefore(c)),d.append("<p>Tu dois valider ton adresse d'abord</p>"),b.preventDefault(),void 0}}),f.click(function(a){if(a.preventDefault(),m()){dg.startFlow(config.base_url+"achat/order/paypalCheckout");var b=setInterval(function(){try{dg.isOpen()||o(b)}catch(a){"TypeError"==a.name?o(b):clearInterval(b)}},1e3)}}),i.click(function(a){a.preventDefault(),m()&&h.submit()})}function o(a){a&&clearInterval(a),$.ajax({url:config.base_url+"achat/orderrest/update",type:"GET",dataType:"json",success:function(a){switch(a.action){case"NO_PAYMENT":case"CANCEL_PAYMENT":case"RESET_COMMAND":document.location.reload();break;case"CONFIRM_PAYMENT":document.location.href=config.base_url}}})}function p(a){a.preventDefault(),$.ajax({url:this.action,type:"POST",data:$(this).serialize(),dataType:"html",success:function(a){addrContainer.html(a)},error:l})}function q(){$.ajax({url:config.base_url+"user/address/edit/"+$(this).data("addr_id"),type:"GET",dataType:"html",success:function(a){addrContainer.html(a)},error:l})}function r(a){a.preventDefault(),$.ajax({url:this.action,type:"POST",data:$(this).serialize(),dataType:"html",success:function(a){addrContainer.html(a)},error:l})}function s(){var b=$(this).data("productref"),c=$(this).data("cartpid");$.ajax({url:config.base_url+"achat/cart/remove",type:"POST",data:{product_ref:b,cart_product_id:c},success:function(){window.location.reload()},error:l})}var a,c,d,e,f,h,i,j,k;$(document).ready(n)})();