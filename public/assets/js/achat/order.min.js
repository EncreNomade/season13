(function(){function j(a){if("debug"==config.readerMode){var b=window.open("_blank");b.document.write(a.responseText)}}function k(){a=$("#accept-cgv"),cgv=$("#cgv_dialog"),addrContainer=$("#order-adresse"),c=$("#askModifyAddress"),d=$("#sendModifyAddress"),e=$("#sendCreateAddress"),f=$("#paypal_submit"),h=$("#checkout"),i=$("#order-detail .remove_product"),i.click(p),addrContainer.on("click","#askModifyAddress",n),addrContainer.on("submit","form",function(a){1==$(this).find("#sendCreateAddress").length?m.call(this,a):1==$(this).find("#sendModifyAddress").length&&o.call(this,a)}),a.change(function(){a.prop("checked")?a.parent().removeClass("alert"):a.parent().addClass("alert")}),$("#show_cgv").click(function(){$.ajax({url:config.publicRoot+"achat/order/CGV",type:"GET",success:function(a){cgv.children(".sep_line").nextAll().remove(),cgv.children(".sep_line").after(a),cgv.addClass("show")}})}),window.PAYPAL&&(dg=new PAYPAL.apps.DGFlow({expType:"instant"})),h.click(function(b){if(!a.prop("checked"))return a.parent().addClass("alert"),b.preventDefault(),void 0;var c=addrContainer.find("form");if(c.length>0){var d=addrContainer.children(".flash-alert");return 0==d.length&&(d=$('<div class="flash-alert">').insertBefore(c)),d.append("<p>Tu dois valider ton adresse d'abord</p>"),b.preventDefault(),void 0}}),f.click(function(b){if(b.preventDefault(),!a.prop("checked"))return a.parent().addClass("alert"),void 0;var c=addrContainer.find("form");if(c.length>0){var d=addrContainer.children(".flash-alert");return 0==d.length&&(d=$('<div class="flash-alert">').insertBefore(c)),d.append("<p>Tu dois valider ton adresse d'abord</p>"),void 0}dg.startFlow(config.base_url+"achat/order/paypalCheckout");var e=setInterval(function(){try{dg.isOpen()||l(e)}catch(a){l(e)}},1e3)})}function l(a){clearInterval(a),$.ajax({url:config.base_url+"achat/orderrest/update",type:"GET",dataType:"json",success:function(a){switch(a.action){case"NO_PAYMENT":case"CANCEL_PAYMENT":document.location.reload();break;case"CONFIRM_PAYMENT":document.location.href=config.base_url}}})}function m(a){a.preventDefault(),$.ajax({url:this.action,type:"POST",data:$(this).serialize(),dataType:"html",success:function(a){addrContainer.html(a)},error:j})}function n(){$.ajax({url:config.base_url+"user/address/edit/"+$(this).data("addr_id"),type:"GET",dataType:"html",success:function(a){addrContainer.html(a)},error:j})}function o(a){a.preventDefault(),$.ajax({url:this.action,type:"POST",data:$(this).serialize(),dataType:"html",success:function(a){addrContainer.html(a)},error:j})}function p(){var b=$(this).data("productref");$.ajax({url:config.base_url+"achat/cart/remove",type:"POST",data:{product_ref:b},success:function(){window.location.reload()},error:j})}var a,c,d,e,f,h,i;$(document).ready(k)})();