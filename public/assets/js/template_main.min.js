fbapi={},fbapi.user=null,fbapi.connect=function(a){return fbapi.callback=a,fbapi.user?("function"==typeof fbapi.callback&&fbapi.callback.call(window,{status:"connected"}),fbapi.callback=!1,void 0):(FB.login(function(a){"connected"==a.status?(fbapi.token=a.authResponse.accessToken,FB.api("/me",function(b){fbapi.user=b,"function"==typeof fbapi.callback&&fbapi.callback.call(window,a),fbapi.callback=!1})):"not_authorized"===a.status?(alert("Ton compte Facebook ne te permet pas de rejoindre notre site, modifie tes param\u00e8tres."),fbapi.callback=!1):(alert("D\u00e9sol\u00e9, facebook n'a pas \u00e9tabli la connexion, recharger la page et r\u00e9essaye dans quelques minutes"),fbapi.callback=!1)},{scope:"publish_stream,read_stream,email,user_birthday,user_photos,photo_upload"}),void 0)},fbapi.checkConnect=function(a,b){FB.getLoginStatus(function(c){"connected"===c.status?(c.authResponse.userID,fbapi.token=c.authResponse.accessToken,FB.api("/me",function(a){fbapi.user=a}),a&&a.call(this,c)):"not_authorized"===c.status?(fbapi.user=!1,fbapi.token="",a&&a.call(window,c)):(fbapi.user=!1,fbapi.token="",b!==!1&&fbapi.connect(a))})},fbapi.like=function(){FB.getLoginStatus(function(a){"connected"===a.status?FB.api("/me/og.likes","post",{object:document.URL},function(a){if(!a||a.error){if(3501==a.error.code)return window.msgCenter?msgCenter.send("Tu aimes d\u00e9j\u00e0 cette page"):alert("Tu aimes d\u00e9j\u00e0 cette page"),void 0;confirm("Une erreur s'est produite lors de l'envoi. Tu veux r\u00e9essayer ? (Code d'erreur: "+a.error.code+")")&&fbapi.connect(fbapi.like)}else{var b=$("<p>Tu as aim\u00e9 cette page sur Facebook. </p>");fbapi.user&&b.append('<a href="'+fbapi.user.link+'" target="_blank">Voir.</a>'),window.msgCenter?msgCenter.send(b):alert("Tu as aim\u00e9 cette page sur Facebook.")}}):confirm("Il faut \u00eatre connect\u00e9 \u00e0 Facebook pour poster un like. Tu veux te connecter?")&&fbapi.connect(fbapi.like)})},fbapi.post=function(a,b,c,d,e){if(a){b||(b="");var f={url:a,message:b};FB.api("me/photos","POST",f,function(a){return a.id?(FB.api(a.id,function(a){if(!a.source)return e(a);var f={imgUrl:a.source,message:b,fbID:a.id,position:c,ep:mse.configs.epid,fbUserID:a.from.id};$.post(config.base_url+"13comments/comment",f,d,"json")}),void 0):e(a)})}else b&&FB.api("/me/feed","POST",{message:b},function(a){if(!a.id)return e(a);var f={imgUrl:"",message:b,fbID:a.id,position:c,ep:mse.configs.epid,fbUserID:a.id.split("_")[0]};$.post(config.base_url+"13comments/comment",f,d,"json")})},fbapi.postGame=function(a){if(a){var b="J'ai "+(a.result.win?"gagn\u00e9":"perdu")+" le jeu "+a.config.title+" en regardant Voodoo Connection, episode "+mse.configs.epid+". Mon score est de "+a.result.score+"! Peux-tu me battre?",c=config.episode.gameExpos?config.episode.gameExpos[a.className]:null;c||(c=config.episode.image);var d={message:b,picture:c,name:a.config.title,link:a.className?config.base_url+"games/"+a.className:document.URL};FB.api("/me/feed","POST",d,function(a){if(a.id)msgCenter.send('<p>Ton resultat de jeu a \u00e9t\u00e9 bien publi\u00e9 sur Facebook. <a href="'+fbapi.user.link+'" target="_blank">Voir.</a></p>');else if(a.error)switch(a.error.code){case 506:msgCenter.send("T'as d\u00e9j\u00e0 post\u00e9 ton score.");break;default:msgCenter.send("Une erreur est survenue lors de l'envoie du message.")}else msgCenter.send("Une erreur est survenue lors de l'envoie du message.")})}},fbapi.commentInit=function(){fbapi.user&&$(".comment_fblike").each(function(){var a=$(this),b=a.data("postid"),c="SELECT%20user_id%20FROM%20like%20WHERE%20object_id%3D"+b+"%20AND%20user_id%3D"+fbapi.user.id,d="/fql?q="+c;FB.api(d,"get",function(b){b&&b.data&&(b.data.length>0?a.text("J'aime plus"):b.error&&console.log("Error: "+b.error.message))})})},fbapi.commentLike=function(){if(fbapi.user){var a=$(this),b=a.data("postid");FB.api("/"+b+"/likes","post",function(a){a===!0?window.msgCenter&&msgCenter.send("You like the post: "+b):a.error&&console.log("Error: "+a.error.message)})}};
(function(){function a(){$(".main_container, #cgv").css({top:$("header").outerHeight(),height:$("body").height()-$("header").outerHeight()-$("footer").outerHeight()}),$("#cpt_banner, #actu_banner").click(function(){window.location="/Voodoo_Connection/season1/episode1?utm_source=banner&utm_medium=banniere"})}$(document).ready(a)})();
var cart=function(a){function f(a){if("debug"==config.readerMode){var b=window.open("_blank");b.document.write(a.responseText)}}function g(a){c.fadeOut(function(){c.html(a),c.fadeIn(),h()})}function h(){var a=c.children(".cart_product").length;a>0?e.text(a).fadeIn():e.fadeOut()}var b=a,c=null,d=null,e=null;return $(document).ready(function(){c=$("#cart_dialog .cart_container"),d=$("#cart"),e=d.children("span"),d.click(b.show),c.on("click",".remove_product button",function(){var c=$(this).parents(".cart_product");c.length>0&&b.remove(c.data("productref"),c.data("cartpid"),c)}),h(),c.on("click",".click_to_offer",b.offerclicked)}),a.show=function(a){$(".dialog").removeClass("show"),$("#cart_dialog").addClass("show");var b=a instanceof jQuery.Event?$(this):d;b.siblings(":not(.text_sep_vertical)").addClass("inactive"),b.removeClass("inactive")},a.add=function(a){$.ajax({url:config.base_url+"achat/cart/add",type:"POST",dataType:"html",data:{product_ref:a},success:function(a){g(a),b.show()},error:f})},a.remove=function(a,c){$.ajax({url:config.base_url+"achat/cart/remove",type:"POST",dataType:"html",data:{product_ref:a,cart_product_id:c},success:function(a){g(a),b.show()},error:f})},a.offer=function(a,c){$.ajax({url:config.base_url+"achat/cart/offer",type:"POST",dataType:"html",data:{offer_target:c,cart_product_id:a},success:function(a){g(a),b.show()},error:f})},a.offerclicked=function(){var c=$(this).parents(".cart_product");if(c.length>0){var d=$(this).parent();$(this).replaceWith('<input type="email" placeholder="Adresse email"/><button>Confirme</button>'),d.children("button").click(function(){var b=d.children("input").val();b&&""!=b&&a.offer(c.data("cartpid"),b)})}},a}({});
function hideDialog(a){a.removeClass("show"),a.prop("id"),$("#conn li").removeClass("inactive")}function showSignup(){$(".dialog").removeClass("show"),$("#signup_dialog").addClass("show");var a=$("#open_signup");a.siblings(":not(.text_sep_vertical)").addClass("inactive"),a.removeClass("inactive"),addCountries($("#signupPays"))}function showLogin(){$(".dialog").removeClass("show"),$("#login_dialog").addClass("show");var a=$("#open_login");a.siblings(":not(.text_sep_vertical)").addClass("inactive"),a.removeClass("inactive")}function showChPass(){$(".dialog").removeClass("show"),$("#change_pass_dialog").addClass("show"),$("#change_pass_dialog").find("cite").text("").removeClass("alert");var a=$("#open_login");a.siblings(":not(.text_sep_vertical)").addClass("inactive"),a.removeClass("inactive")}function showLinkFb(){$(".dialog").removeClass("show"),$("#link_fb_dialog").addClass("show"),$("#link_fb_dialog").find("cite").text("").removeClass("alert");var a=$("#open_login");a.siblings(":not(.text_sep_vertical)").addClass("inactive"),a.removeClass("inactive")}function showUpdate(){$(".dialog").removeClass("show"),$("#update_dialog").addClass("show");var a=$("#user_id");a.siblings(":not(.text_sep_vertical)").addClass("inactive"),a.removeClass("inactive"),addCountries($("#updatePays"))}function addCountries(a){if(2>a.children().length&&config.countries)for(var b in config.countries)a.append('<option value="'+b+'">'+config.countries[b]+"</option>")}function monthChanged(){var a=parseInt($("#signupbMonth").val()),b=parseInt($("#signupbDay").val()),c="",d=[4,6,9,11],e=30;if(2==a)var e=28;else if(-1!=$.inArray(a,d))var e=30;else e=31;for(var f=1;e>=f;++f)c+="<option value='"+f+"'>"+f+"</option>";$("#signupbDay").html(c),e>=b&&$("#signupbDay").val(b)}function updateMonthChanged(){var a=parseInt($("#updatebMonth").val()),b=parseInt($("#updatebDay").val()),c="",d=[4,6,9,11],e=30;if(2==a)var e=28;else if(-1!=$.inArray(a,d))var e=30;else e=31;for(var f=1;e>=f;++f)c+="<option value='"+f+"'>"+f+"</option>";$("#updatebDay").html(c),e>=b&&$("#updatebDay").val(b)}(function(){function b(){hideDialog($(this).parents(".dialog"))}function c(){function d(a){if("not_authorized"===a.status)return alert("Ton compte Facebook ne te permet pas de rejoindre notre site"),void 0;var b=fbapi.token;$.ajax({url:config.publicRoot+"base/login_fb",type:"POST",dataType:"json",data:{fb_token:b},success:function(a){if(a.valid)document.location.reload();else{switch(a.errorCode){case 10:case 11:break;case 12:showLinkFb(),a.errorMessage=""}a.errorMessage&&""!=a.errorMessage&&alert("Erreur de connexion: "+a.errorMessage),$("input[type=submit]").removeAttr("disabled")}},error:function(){alert("D\u00e9sol\u00e9, une erreur inconnue s'est produite, tu peux nous contacter: contact@encrenomade.com"),$("input[type=submit]").removeAttr("disabled")}})}$("#open_signup").click(showSignup),$("#toSignup").click(showSignup),$("#open_login").click(showLogin),$("#toLogin").click(showLogin),$("#dialog_mask").click(hideDialog),$("#user_id").click(showUpdate),$("#signupbMonth").change(monthChanged),$("#updatebMonth").change(updateMonthChanged),$(".dialog .close").unbind("click",b).click(b),$(".flash-close").click(function(){var a=$(this).parent(".flash-alert");a.fadeOut(500),setTimeout(function(){a.remove()},500)});var c={type:"POST",dataType:"json",success:function(a){a.valid?document.location.reload():(a.errorType&&("mail"==a.errorType?$("#signupMail").siblings("label").addClass("alert"):"pseudo"==a.errorType&&$("#signupId").siblings("label").addClass("alert")),a.errorMessage&&alert("Erreur d'inscription: "+a.errorMessage),$("input[type=submit]").removeAttr("disabled"))},error:function(){alert("D\u00e9sol\u00e9, une erreur inconnue s'est produite, tu peux nous contacter: contact@encrenomade.com"),$("input[type=submit]").removeAttr("disabled")}};$("#signupForm").ajaxForm(c),$("#signupBtn").click(function(b){$("#signupForm").find("cite, label").removeClass("alert");var c=$("#signupId").val(),d=$("#signupPass").val(),e=$("#signupConf").val();$("#signupSex").val();var g=$("#signupbDay").val()+"/"+$("#signupbMonth").val()+"/"+$("#signupbYear").val();$("#signupBirthday").val(g);var h=$("#signupMail").val();$("#signupPays").val();var j=$("#signupCP").val(),k=$("#signupPortable").val();$("#signupNotif").val();var m=!0;""==c&&($("#signupId").siblings("cite").addClass("alert"),m=!1),""==d?($("#signupPass").siblings("cite").addClass("alert"),m=!1):6>d.length&&($("#signupPass").siblings("cite").addClass("alert"),m=!1),(""==e||e!=d)&&($("#signupConf").siblings("cite").addClass("alert"),m=!1),a.mail.test(h)||($("#signupMail").siblings("label").addClass("alert"),m=!1),""==k||a.telephone.test(k)||($("#signupPortable").siblings("cite").addClass("alert"),m=!1),""==j||a.codpos.test(j)||($("#signupCP").siblings("label").addClass("alert"),m=!1),m||b.preventDefault(),$("input[type=submit]",this).attr("disabled","disabled"),$("#signupForm").each(function(){fuel_set_csrf_token(this)})}),$("#signupForm .fb_btn").click(function(){FB.login(function(a){if("connected"==a.status){var b=a.authResponse.accessToken;FB.api("me",function(a){$("#signupId").val(a.username),$("#signupSex").val("male"==a.gender?"m":"f");var c=a.birthday.split("/");$("#signupbDay").val(c[1]),$("#signupbMonth").val(c[0]),$("#signupbYear").val(c[2]),$("#signupMail").attr("readonly","readonly").val(a.email),$("#signup_fbToken").val(b),alert("Compl\u00e8te ton formulaire d'inscription pour t'inscrire")})}else"not_authorized"===a.status?alert("Ton compte Facebook ne te permet pas de rejoindre notre site"):alert("D\u00e9sol\u00e9, une erreur inconnue s'est produite, veuilles recharger la page et r\u00e9essayer")},{scope:"publish_stream,read_stream,email,user_birthday,user_photos,photo_upload"})}),$("#loginForm .fb_btn").click(function(){fbapi.connect(d)});var c={type:"POST",dataType:"json",success:function(a){if(a.valid)return alert("F\u00e9licitation, d\u00e9sormais tu peux te connecter avec ton compte Facebook."),document.location.reload(),void 0;switch(a.errorCode){case 1:$("#linkfbPass").siblings("label").addClass("alert"),$("#linkfbId").siblings("label").addClass("alert");break;case 2:$("#linkfbId").siblings("label").addClass("alert");break;case 3:$("#linkfbPass").siblings("label").addClass("alert");break;case 10:case 11:case 13:alert(a.errorMessage),document.location.reload();break;default:alert("D\u00e9sol\u00e9, une erreur inconnue s'est produite, veuilles recharger la page et r\u00e9essayer")}$("input[type=submit]").removeAttr("disabled")},error:function(){alert("D\u00e9sol\u00e9, une erreur inconnue s'est produite, tu peux nous contacter: contact@encrenomade.com"),$("input[type=submit]").removeAttr("disabled")}};$("#linkFbForm").ajaxForm(c),$("#linkfbBtn").click(function(a){$("#linkFbForm").find("cite, label").removeClass("alert");var b=$("#linkfbId").val(),c=$("#linkfbPass").val(),d=!0;return""==b&&($("#linkfbId").siblings("label").addClass("alert"),d=!1),""==c&&($("#linkfbPass").siblings("label").addClass("alert"),d=!1),d?($("#linkfbToken").prop("value",fbapi.token),$("input[type=submit]",this).attr("disabled","disabled"),fuel_set_csrf_token($("#linkFbForm").get(0)),void 0):(a.preventDefault(),void 0)}),$("#loginForm").submit(function(a){a.preventDefault();var b=$("#loginId").val(),c=$("#loginPass").val(),d=!0;if(""==b&&($("#loginId").siblings("label").addClass("alert"),d=!1),""==c&&($("#loginPass").siblings("label").addClass("alert"),d=!1),d){$("input[type=submit]",this).attr("disabled","disabled");var e={identifiant:b,password:c};$.ajax({url:config.publicRoot+"base/login_normal",dataType:"json",type:"POST",data:e,success:function(a){a.valid?document.location.reload():(a.errorMessage&&alert("Erreur de connexion: "+a.errorMessage),$("input[type=submit]").removeAttr("disabled"))},error:function(){alert("D\u00e9sol\u00e9, une erreur inconnue s'est produite, tu peux nous contacter: contact@encrenomade.com"),$("input[type=submit]").removeAttr("disabled")}})}});var c={type:"POST",dataType:"json",success:function(a){a.valid?($("#chpass_mail").siblings("cite").text("Ton nouveau mot de passe a \u00e9t\u00e9 envoy\u00e9."),alert("Ton nouveau mot de passe a \u00e9t\u00e9 envoy\u00e9."),hideDialog($("#change_pass_dialog")),$("input[type=submit]").removeAttr("disabled")):($("#chpass_mail").siblings("cite").text(a.errorMessage).addClass("alert"),$("input[type=submit]").removeAttr("disabled"))},error:function(){$("#chpass_mail").siblings("cite").text("D\u00e9sol\u00e9, une erreur inconnue s'est produite, tu peux nous contacter: contact@encrenomade.com").addClass("alert"),$("input[type=submit]").removeAttr("disabled")}};$("#chPassForm").ajaxForm(c),$("#chPassBtn").click(function(){$("#chPassForm").find("cite, label").removeClass("alert"),$("input[type=submit]",this).attr("disabled","disabled"),fuel_set_csrf_token($("#chPassForm").get(0))});var c={type:"POST",dataType:"json",success:function(a){a.valid?document.location.reload():(a.errorType&&"password"==a.errorType&&$("#updateOldPass").siblings("label").addClass("alert"),a.errorMessage&&alert("Erreur de la mise \u00e0 jour: "+a.errorMessage),$("input[type=submit]").removeAttr("disabled"))},error:function(){alert("D\u00e9sol\u00e9, une erreur inconnue s'est produite, tu peux nous contacter: contact@encrenomade.com"),$("input[type=submit]").removeAttr("disabled")}};$("#updateForm").ajaxForm(c),$("#updateBtn").click(function(b){$("#updateForm").find("cite, label").removeClass("alert");var c=$("#updatePass").val(),d=$("#updateConf").val();$("#updateSex").val();var f=$("#updatebDay").val()+"/"+$("#updatebMonth").val()+"/"+$("#updatebYear").val();$("#updateBirthday").val(f),$("#updatePays").val();var h=$("#updateCP").val(),i=$("#updatePortable").val();$("#updateNotif").val();var k=$("#updateOldPass").val(),l=!0;""!=c&&6>c.length&&($("#updatePass").siblings("cite").addClass("alert"),l=!1),""!=d&&d!=c&&($("#updateConf").siblings("cite").addClass("alert"),l=!1),""==h||a.codpos.test(h)||($("#updateCP").siblings("label").addClass("alert"),l=!1),""==i||a.telephone.test(i)||($("#updatePortable").siblings("cite").addClass("alert"),l=!1),""==k&&($("#updateOldPass").siblings("cite").addClass("alert"),l=!1),l||b.preventDefault(),$("input[type=submit]",this).attr("disabled","disabled"),fuel_set_csrf_token($("#updateForm").get(0))}),$("#logout").click(function(){$.ajax({url:config.publicRoot+"base/logout",dataType:"json",type:"GET",success:function(a){a.valid?document.location.reload():(a.errorMessage&&alert("Erreur de d\u00e9connexion: "+a.errorMessage),$("input[type=submit]").removeAttr("disabled"))},error:function(){alert("D\u00e9sol\u00e9, une erreur inconnue s'est produite, tu peux nous contacter: contact@encrenomade.com"),$("input[type=submit]").removeAttr("disabled")}})})}var a={date:/^\d{2}\/\d{2}\/\d{4}$/,mail:/^[\w\.\_\-]+@[\w\.\_\-]+$/,telephone:/^[\d]+$/,errcode:/\d{4}/g,codpos:/^[\d]+$/};$(document).ready(c)})();
