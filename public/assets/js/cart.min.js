var cart=function(a){function f(a){if("debug"==config.readerMode){var b=window.open("_blank");b.document.write(a.responseText)}}function g(a){c.fadeOut(function(){c.html(a),c.fadeIn(),h()})}function h(){var a=c.children(".cart_product").length;a>0?e.text(a).fadeIn():e.fadeOut()}var b=a,c=null,d=null,e=null;return $(document).ready(function(){c=$("#cart_dialog .cart_container"),d=$("#cart"),e=d.children("span"),d.click(b.show),c.on("click",".remove_product button",function(){var c=$(this).parents(".cart_product");c.length>0&&b.remove(c.data("productref"),c.data("cartpid"),c)}),h(),c.on("click",".click_to_offer",b.offerclicked)}),a.show=function(a){$(".dialog").removeClass("show"),$("#cart_dialog").addClass("show");var b=a instanceof jQuery.Event?$(this):d;b.siblings(":not(.text_sep_vertical)").addClass("inactive"),b.removeClass("inactive")},a.add=function(a){$.ajax({url:config.base_url+"achat/cart/add",type:"POST",dataType:"html",data:{product_ref:a},success:function(a){g(a),b.show()},error:f})},a.remove=function(a,c){$.ajax({url:config.base_url+"achat/cart/remove",type:"POST",dataType:"html",data:{product_ref:a,cart_product_id:c},success:function(a){g(a),b.show()},error:f})},a.offer=function(a,c){$.ajax({url:config.base_url+"achat/cart/offer",type:"POST",dataType:"html",data:{offer_target:c,cart_product_id:a},success:function(a){g(a),b.show()},error:f})},a.offerclicked=function(){var c=$(this).parents(".cart_product");if(c.length>0){var d=$(this).parent();$(this).replaceWith('<input type="email" placeholder="Adresse email"/><button>Confirme</button>'),d.children("button").click(function(){var b=d.children("input").val();b&&""!=b&&a.offer(c.data("cartpid"),b)})}},a}({});