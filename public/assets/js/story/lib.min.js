function angleForLine(a,b,c,d){var e=0,f=c-a,g=d-b;return e=Math.atan2(g,f)}function mseAngleForLine(a,b,c,d){var e=0,f=c-a,g=d-b;return e=Math.atan2(g,f),Math.round(180*e/Math.PI)}function angleFor2Point(a,b){var c=0,d=b.x-a.x,e=b.y-a.y;return c=Math.atan2(e,d),Math.round(180*c/Math.PI)}function ptRotated(a,b,c,d,e){var f=a-c,g=b-d,h=Math.sin(e),i=Math.cos(e),j=f*i+g*h,k=-f*h+g*i;return{x:c+j,y:d+k}}function inRegion(a,b,c,d,e,f,g){if(!isNaN(g)&&0!=g){var h=ptRotated(a,b,c,d,g);a=h.x,b=h.y}var i=a-c,j=b-d;return i>=0&&e>=i&&j>=0&&f>=j?!0:!1}function distance2Pts(a,b,c,d){return Math.sqrt(Math.pow(c-a,2)+Math.pow(d-b,2))}function inrect(a,b,c){return a>=c[0]&&c[0]+c[2]>=a&&b>=c[1]&&c[1]+c[3]>=b?!0:!1}function imgBoundingInBox(a,b,c){if("string"==typeof a&&(a=mse.src.getSrc(a)),!(a&&a instanceof Image))return{pos:[0,0],size:[0,0]};var d=b/a.width,e=c/a.height,f=e>d?d:e,g=a.width*f,h=a.height*f,i=(b-g)/2,j=(c-h)/2;return{pos:[i,j],size:[g,h]}}function mseLog(a,b){var c=Error();throw c.name=a,c.message=b,c}function clipRect(a,b,c,d,e){a.beginPath(),a.moveTo(b,c),a.lineTo(d,c),a.lineTo(d,e),a.lineTo(b,e),a.closePath(),a.clip()}function randomInt(a){return Math.floor(Math.random()*a)}function checkFontSize(a){var b=/\s*([\d\.]*)px/.exec(a);return b[1]}function checkNextLine(a,b,c,d){if(c>=b.length)return b.length;var e,f=c;do{e=f;var g=b.substr(e).search(/[\s\n\r\-\/\\\:]/);if(g=-1==g?-1:e+g,-1==g){d>=a.measureText(b).width&&(e=b.length);break}var h=a.measureText(b.substr(0,g));f=g+1}while(d>h.width);if(e!=c)return e;var i=b.lastIndexOf(" ",c);return-1==i?c:i+1}function wrapText(a,b,c,d){if(0>=c)return[a];var e=Array();if(d){var f=b.font;b.font=d}for(var g=Math.floor(c/b.measureText("A").width),h=0;a.length>h;){var i=checkNextLine(b,a.substr(h),g,c);e.push(a.substr(h,i)),h+=i}return d&&(b.font=f),e}function wrapTextWithWrapIndice(a,b,c,d){var e=a.split("\n");1==e.length&&(e=a.split("\\n"));var f=Array();for(var g in e){var h=wrapText(e[g],b,c,d);f=f.concat(h)}return f}function extend(a,b){var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a,a.uber=b.prototype}CanvasRenderingContext2D.prototype.fillRoundRect=function(a,b,c,d,e){this.beginPath(),this.moveTo(a,b+e),this.lineTo(a,b+d-e),this.quadraticCurveTo(a,b+d,a+e,b+d),this.lineTo(a+c-e,b+d),this.quadraticCurveTo(a+c,b+d,a+c,b+d-e),this.lineTo(a+c,b+e),this.quadraticCurveTo(a+c,b,a+c-e,b),this.lineTo(a+e,b),this.quadraticCurveTo(a,b,a,b+e),this.fill()},CanvasRenderingContext2D.prototype.strokeRoundRect=function(a,b,c,d,e){this.beginPath(),this.moveTo(a,b+e),this.lineTo(a,b+d-e),this.quadraticCurveTo(a,b+d,a+e,b+d),this.lineTo(a+c-e,b+d),this.quadraticCurveTo(a+c,b+d,a+c,b+d-e),this.lineTo(a+c,b+e),this.quadraticCurveTo(a+c,b,a+c-e,b),this.lineTo(a+e,b),this.quadraticCurveTo(a,b,a,b+e),this.stroke()},CanvasRenderingContext2D.prototype.fillTextWrapped=function(a,b,c,d,e){var f=wrapTextWithWrapIndice(a,this,d);e||(e=1.2*checkFontSize(ctx.font));for(var g=0;f.length>g;g++)this.fillText(f[g],b,c+e*g);return e*f.length},Object.keys||(Object.keys=function(){var a=Object.prototype.hasOwnProperty,b=!{toString:null}.propertyIsEnumerable("toString"),c=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],d=c.length;return function(e){if("object"!=typeof e&&"function"!=typeof e||null===e)throw new TypeError("Object.keys called on non-object");var f=[];for(var g in e)a.call(e,g)&&f.push(g);if(b)for(var h=0;d>h;h++)a.call(e,c[h])&&f.push(c[h]);return f}}());var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",decode:function(a){var c,d,e,f,g,h,i,b="",j=0;for(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");a.length>j;)f=this._keyStr.indexOf(a.charAt(j++)),g=this._keyStr.indexOf(a.charAt(j++)),h=this._keyStr.indexOf(a.charAt(j++)),i=this._keyStr.indexOf(a.charAt(j++)),c=f<<2|g>>4,d=(15&g)<<4|h>>2,e=(3&h)<<6|i,b+=String.fromCharCode(c),64!=h&&(b+=String.fromCharCode(d)),64!=i&&(b+=String.fromCharCode(e));return b=Base64._utf8_decode(b)},_utf8_decode:function(a){for(var b="",c=0,d=c1=c2=0;a.length>c;)d=a.charCodeAt(c),128>d?(b+=String.fromCharCode(d),c++):d>191&&224>d?(c2=a.charCodeAt(c+1),b+=String.fromCharCode((31&d)<<6|63&c2),c+=2):(c2=a.charCodeAt(c+1),c3=a.charCodeAt(c+2),b+=String.fromCharCode((15&d)<<12|(63&c2)<<6|63&c3),c+=3);return b},decodeBase64AsArray:function(a,b){b=b||1;var e,f,g,c=Base64.decode(a),d=[];for(e=0,g=c.length/b;g>e;e++)for(d[e]=0,f=b-1;f>=0;--f)d[e]+=c.charCodeAt(e*b+f)<<(f<<3);return d}},ObjectPool=function(a,b,c){this.capacity=b,this.objCons=a,c&&(this.activeList=c),this.pool=[],this.NewObjCons=function(b){var c=a.apply(this,b);return this._refCount=1,c},this.NewObjCons.prototype=a.prototype};ObjectPool.prototype={constructor:ObjectPool,initInstance:function(){var a=Array.prototype.slice.call(arguments);for(var b in this.pool)if(0===this.pool[b]._refCount)return this.objCons.apply(this.pool[b],a),this.pool[b]._refCount=1,this.activeList&&this.activeList.push(this.pool[b]),this.pool[b];var c=new this.NewObjCons(a);return this.pool.push(c),this.activeList&&this.activeList.push(c),c},retain:function(a){var b=this.pool.indexOf(a);-1!=b&&(isNaN(a._refCount)?a._refCount=1:a._refCount++)},release:function(a){var b=this.pool.indexOf(a);if(-1!=b&&(isNaN(a._refCount)?a._refCount=0:a._refCount>0&&a._refCount--,0==a._refCount&&this.activeList)){var b=this.activeList.indexOf(a);-1!=b&&this.activeList.splice(b,1)}},clear:function(){for(var a in this.pool)this.pool[a]._refCount>=0&&(this.pool[a]._refCount=0);this.activeList&&this.activeList.splice(0,this.activeList.length)}};var MseScenario=function(){this.actions=[],this._progress=0};MseScenario.prototype={constructor:MseScenario,get progress(){return this._progress},set progress(a){!isNaN(a)&&this.actions.length>a&&a>=0&&(this._progress=a)},reset:function(){for(var a in this.actions)this.actions[a].reset();this.progress=0},quit:function(){this.actions[this.progress].quit(),this.progress=0},run:function(a){this.progress=a;var b=this.actions[this.progress];b.beginDelay?setTimeout(function(){b.start()},b.beginDelay):b.start()},passNext:function(){this.progress<this.actions.length&&this.actions[this.progress].end()},actionEnded:function(a){var b=this.actions.indexOf(a);if(-1!=b)if(a.endDelay){var c=this;setTimeout(function(){c.run(b+1)},a.endDelay)}else this.run(b+1)},addActions:function(a){if($.isArray(a))for(var b in a)this.addAction(a[b])},getAction:function(a){for(var b in this.actions)if(this.actions[b].name==a)return this.actions[b];return null},addAction:function(a){a instanceof MseAction&&(this.actions.push(a),a.scenario=this)},insertActionAfter:function(a,b){a instanceof MseAction&&(b instanceof String&&(b=this.getAction(b)),id=this.actions.indexOf(b),id>=0&&(this.actions.splice(id,0,a),a.scenario=this))}};var MseAction=function(a,b,c,d){if(this.state="INIT",this.scenario=null,this.name=a,"object"==typeof b)for(var e in b)this[e]||(this[e]=b[e]);c&&"function"==typeof c&&(this.realStart=c),d&&"function"==typeof d&&(this.realEnd=d)};MseAction.prototype={constructor:MseAction,realStart:function(){},realEnd:function(){},reset:function(){this.state="INIT"},quit:function(){this.realEnd(),this.state="END"},start:function(){"INIT"==this.state&&(this.state="START",this.realStart())},end:function(){"START"==this.state&&(this.realEnd(),this.state="END",this.scenario&&this.scenario.actionEnded(this))}};var MseTutoMsg=function(a,b,c){this._box=$('<div class="tutoBox"></div>'),this._boxText=$('<h5 class="msg"></h5>'),this._boxClose=$("<span>x</span>"),this._boxIndicator=$('<div class="img"></div>'),this._box.append(this._boxText).append(this._boxIndicator);var d=this;this._boxClose.click(function(){d.hide()}),this.reinit(a,b,c)};MseTutoMsg.prototype={constructor:MseTutoMsg,boxIndicatorSize:10,get target(){return this._target},set target(a){this._target=a,this.position="auto",this.reposition(),this._visible&&this.animateTarget()},get message(){return this._message},set message(a){this._message=a,this._boxText.html(a),this.reposition()},reinit:function(a,b,c){if(this._target=a,this._message=b,this.position="auto",this.animate=!1,this._boxText.html(b),c){if(c.closeBtn?0==this._boxClose.parent().length&&this._boxText.after(this._boxClose):this._boxClose.detach(),c.width&&this._box.width(c.width),c.height&&this._box.height(c.height),c.position&&(this.position=c.position),c.offset){this.position="fixed";var d=this._target.offset();d.top+=c.offset.top,d.left+=c.offset.left,d.top-=this.boxIndicatorSize,this._box.offset(d)}c.animate&&(this.animate=c.animate)}return this.hide(),this},reposition:function(){this._boxIndicator.removeClass("top bottom left right"),this._boxIndicator.css("left","initial");var a={width:this._box.width(),height:this._box.height()},b={width:$(window).width(),height:$(window).height()},c=this._target.offset();switch(this.position){case"fixed":return;case"left":c.left-=a.width+this.boxIndicatorSize,this._boxIndicator.addClass("right");break;case"right":c.left+=this._target.width()+this.boxIndicatorSize,this._boxIndicator.addClass("left"),this._boxIndicator.css("left","-8px");break;case"bottom":c.top+=this._target.height()+this.boxIndicatorSize,this._boxIndicator.addClass("top");break;case"top":c.top-=a.height+this.boxIndicatorSize,this._boxIndicator.addClass("bottom");break;case"center":c.top+=this._target.height()/2-(a.height+this.boxIndicatorSize),c.left+=this._target.width()/2-a.width/2,this._boxIndicator.addClass("center");break;default:c.top-=a.height+this.boxIndicatorSize,0>=c.left?c.left=0:c.left+a.width>b.width&&(c.left=b.width-a.width),0>=c.top?(c.top=this._target.height()+this.boxIndicatorSize,this._boxIndicator.addClass("top")):c.top+a.height>b.height&&(c.top=b.height-a.height);var d=this._target.width()/2,e=this.boxIndicatorSize,f=d-e/2;f>a.width?f=a.width-e:0>f&&(f=0),this._boxIndicator.css("left",f+"px")}this._box.offset(c)},show:function(){this._box.appendTo("body"),this.reposition(),this.animateTarget(),this._visible=!0},hide:function(){this._box.detach(),this._visible=!1},animateTarget:function(){if(this.animate){var a={opacity:this._target.css("opacity")},b={opacity:.4},c={opacity:1};this._target.animate(b).animate(c).animate(b).animate(c).animate(b).animate(c).animate(a)}}};
var Callback=function(a,b){if("function"!=typeof a)return console.error("Fail to initialize a Callback object: except first parameter to be a function"),void 0;if(this.func=a,this.caller=b,this.args=null,arguments.length>2){this.args=Array();for(var c=2;arguments.length>c;c++)this.args.push(arguments[c])}this.linked=null};Callback.prototype={link:function(a){a instanceof Callback&&(this.linked||(this.linked=Array()),this.linked.push(a))},invoke:function(){var a=null;if(this.args)a=arguments.length>0?this.args.concat(Array.prototype.slice.call(arguments)):this.args;else if(!this.args&&arguments.length>0)var a=arguments;if(this.func.apply(this.caller,a),this.linked)for(var b in this.linked)this.linked[b].invoke()}};var Path=function(a){this.pts=[],this.add(a)};Path.prototype={constructor:Path,add:function(a){isNaN(a.x)||isNaN(a.y)||this.pts.push({x:a.x,y:a.y})},origin:function(){return this.pts[0]},last:function(){return this.pts[this.pts.length-1]},toString:function(){return"[object Path]"}};var GestureAnalyser=function(a){this.blobs={},this.count=0,this.listeners=a,this.tapwait=!1,this.tapid=0};GestureAnalyser.prototype={constructor:GestureAnalyser,addBlob:function(a){for(var b in a.touches)this.blobs[b]=null,this.blobs[b]=new Path(a.touches[b]),this.count++,this.analyseAdd(b)},updateBlob:function(a){for(var b in a.touches)this.blobs[b]&&(this.blobs[b].add(a.touches[b]),this.analyseUpdate(b))},removeBlob:function(a){for(var b in a.touches)this.blobs[b]&&(this.analyseRemove(b),this.count--,delete this.blobs[b])},analyseAdd:function(){1==this.count||2==this.count},analyseUpdate:function(a){if(1==this.count){var b=this.blobs[a].origin(),c=this.blobs[a].last(),d={dx:c.x-b.x,dy:c.y-b.y,type:"translation"};this.listeners.eventNotif("translate",d)}else if(2==this.count){var b=[],c=[],e=[];for(var a in this.blobs){var f=this.blobs[a];e.push(f),b.push(f.origin()),c.push(f.last())}if(this.listeners.hasListener("scale")){var g=[b[1].x-b[0].x,b[1].y-b[0].y],h=[c[1].x-c[0].x,c[1].y-c[0].y],i=Math.sqrt(g[0]*g[0]+g[1]*g[1]),j=Math.sqrt(h[0]*h[0]+h[1]*h[1]),d={scale:j/i,type:"scale"};this.listeners.eventNotif("scale",d)}if(this.listeners.hasListener("translate2")){var k=angleFor2Point(b[0],c[0]),l=angleFor2Point(b[1],c[1]);if(20>=Math.abs(k-l)){var m=e[0].pts[e[0].pts.length-2];this.listeners.eventNotif("translate2",{deltaDx:c[0].x-m.x,deltaDy:c[0].y-m.y,dx:c[0].x-b[0].x,dy:c[0].y-b[0].y,type:"translate2"})}}b=null,c=null,e=null}},analyseRemove:function(){1==this.count||2==this.count}},function(a){function s(){l=!1}function t(b){if(null==a.fn.mseInteraction.prototype.dominateElem||a.fn.mseInteraction.prototype.dominateElem==a(this).get(0)){if(b.data&&b.data.target)var d=b.data.target.get(0);else var d=a(this).get(0);if(i=a.data(d,"mselisteners"),k=a.data(d,"mseAnalyser"),j=a.data(d,"mseSrc"),j=j?j:a(this),i){var e=(b.originalEvent?b.originalEvent:b)||window.event,f=new A(e);switch(f.type){case"click":i.eventNotif("click",f),i.hasListener("doubleClick")&&MseConfig.mobile&&(l?(f.type="doubleClick",i.eventNotif("doubleClick",f),l=!1):(l=!0,_target=f.target,setTimeout(s,c)));break;case"dblclick":f.type="doubleClick",i.eventNotif("doubleClick",f);break;case"mousedown":w(b);break;case"mousemove":null!=h&&x(b),i.hasListener("move")&&(f.type="move",f.prev=n,i.eventNotif("move",f),n=[f.offsetX,f.offsetY]);break;case"mouseup":null!=h&&y(b);break;case"mousewheel":i.eventNotif("scroll",f);break;case"taphold":f.type="longPress",i.eventNotif("longPress",f);break;case"touchstart":1===b.touches.length&&w(b);var e=new B(b,"multiGestAdd");k.addBlob(e),i.eventNotif("gestureMulti",e);break;case"touchmove":1===b.touches.length&&(x(b),i.hasListener("move")&&(f.type="move",f.prev=n,i.eventNotif("move",f),n=[f.offsetX,f.offsetY]));var e=new B(b,"multiGestUpdate");k.updateBlob(e),i.eventNotif("gestureMulti",e);break;case"touchend":0===b.touches.length&&y(b);var e=new B(b,"multiGestRemove");k.removeBlob(e),i.eventNotif("gestureMulti",e);break;case"swipeleft":case"swiperight":i.eventNotif(f.type,f);break;case"keypress":case"keydown":case"keyup":i.eventNotif(f.type,f)}}}}function u(){h&&(h.type="longPress",i.eventNotif("longPress",h))}function v(){m=!1}function w(a){h=new A(a,!0),z(a),i.hasListener("longPress")&&(b=setTimeout(u,d)),MseConfig.mobile&&i.hasListener("click")&&(m=!0,setTimeout(v,e)),i.hasListener("gestureSingle")&&(h.type="gestureStart",i.eventNotif("gestureSingle",h))}function x(a){h&&(z(a),i.hasListener("longPress")&&clearTimeout(b),h.type="gestureUpdate",i.eventNotif("gestureSingle",h))}function y(){if(h){if(h.offsetX=h.listX[h.listX.length-1],h.offsetY=h.listY[h.listY.length-1],h.corrected&&(h.corrected=!1),m&&(h.type="click",i.eventNotif("click",h),m=!1),i.hasListener("longPress")&&clearTimeout(b),i.hasListener("swipe")){if(!MseConfig.mobile){for(var c=h.listY[0],d=h.listY[0],e=h.listX.length,j=!0,k=!0,l=1;e>l&&(h.listY[l]>c&&(c=h.listY[l]),d>h.listY[l]&&(d=h.listY[l]),!(k&&h.listX[l]<h.listX[l-1])||(k=!1,j))&&(!(j&&h.listX[l]>h.listX[l-1])||(j=!1,k));l++);h.distance=Math.abs(h.listX[e-1]-h.listX[0]),g>c-d&&h.distance>f&&(j?(h.type="swipeleft",i.eventNotif("swipe",h)):k&&(h.type="swiperight",i.eventNotif("swipe",h)))}for(var n=h.listX[0],o=h.listX[0],e=h.listX.length,p=!0,q=!0,l=1;e>l&&(h.listX[l]>n&&(n=h.listX[l]),o>h.listX[l]&&(o=h.listX[l]),!(p&&h.listY[l]>h.listY[l-1])||(p=!1,q))&&(!(q&&h.listY[l]<h.listY[l-1])||(q=!1,p));l++);h.distance=Math.abs(h.listY[e-1]-h.listY[0]),g>n-o&&h.distance>f&&(p?(h.type="swipeup",i.eventNotif("swipe",h)):q&&(h.type="swipedown",i.eventNotif("swipe",h)))}h.type="gestureEnd",i.eventNotif("gestureSingle",h),h=null}}function z(b){h.original=b;var c=a(b.target).offset();if(b.type.indexOf("mouse")>=0){if("Firefox"===MseConfig.browser)var d=b.pageX-c.left,e=b.pageY-c.top;else var d=b.offsetX,e=b.offsetY;h.listX.push(d),h.listY.push(e),h.windowX=b.pageX,h.windowY=b.pageY}else{var f=b.targetTouches[0];h.listX.push(f.pageX-c.left),h.listY.push(f.pageY-c.top),h.windowX=f.pageX,h.windowY=f.pageY}h.offsetX=h.listX[h.listX.length-1],h.offsetY=h.listY[h.listY.length-1],h.corrected&&(h.corrected=!1)}function A(b,c){if(this.target=b.target,this.original=b,this.preventDefault=function(){this.original.preventDefault()},this.type=c?"temporary":b.type,this.windowX=b.clientX,this.windowY=b.clientY,"touchmove"===b.type){var d=b.targetTouches[0];this.offsetX=d.pageX-a(b.target).offset().left,this.offsetY=d.pageY-a(b.target).offset().top}else"Firefox"===MseConfig.browser?(this.offsetX=b.pageX-a(b.target).offset().left,this.offsetY=b.pageY-a(b.target).offset().top):(this.offsetX=b.offsetX,this.offsetY=b.offsetY);c&&(this.listX=Array(),this.listY=Array()),("keydown"===b.type||"keyup"===b.type)&&(this.keyCode=b.keyCode,this.charCode=b.keyCode,this.altKey=b.altKey,this.ctrlKey=!1,this.shiftKey=b.shiftKey),"keypress"===b.type&&(this.altKey=null==b.altKey?!1:b.altKey,this.ctrlKey=!1,this.shiftKey=null==b.shiftKey?!1:b.shiftKey,"Firefox"===MseConfig.browser?(this.keyCode=b.charCode,this.charCode=b.charCode):(this.keyCode=b.keyCode,this.charCode=b.keyCode)),"DOMMouseScroll"===b.type?(this.rolled=b.detail?-40*b.detail:0,this.type="mousewheel"):"mousewheel"===b.type&&(this.rolled=b.wheelDelta?b.wheelDelta:0)}function B(b,c){b.preventDefault(),this.target=b.target,this.type=c,this.touches={};for(var d=a(b.target).position(),e=0;b.changedTouches.length>e;++e){var f=b.changedTouches[e];if(f.identifier){var g=f.pageX-d.left,h=f.pageY-d.top;this.touches[f.identifier]={x:g,y:h,evt:c}}}}var b,h,i,j,k,c=400,d=1e3,e=200,f=40,g=30,l=!1,m=!1,n=[0,0],o={click:"click",doubleClick:"dblclick",longPress:"mousedown mousemove mouseup",move:"mousemove",swipe:"mousedown mousemove mouseup",gestureSingle:"mousedown mousemove mouseup",keydown:"keydown",keypress:"keypress",keyup:"keyup",scroll:"mousewheel DOMMouseScroll"},p={click:"click",doubleClick:"click",longPress:"taphold",move:"touchmove",swipe:"touchstart touchmove touchend",swipeleft:"swipeleft",swiperight:"swiperight",gestureSingle:"touchstart touchmove touchend",gestureMulti:"touchstart touchmove touchend",translate:"touchstart touchmove touchend",scale:"touchstart touchmove touchend",translate2:"touchstart touchmove touchend"},q=function(){this.listeners={}};q.prototype={addListener:function(a,b,c){"string"==typeof a&&b instanceof Callback&&(b.prevent=c===!0?c:!1,this.listeners[a]=b)},removeListener:function(a){delete this.listeners[a]},hasListener:function(a){return null!=this.listeners[a]},eventNotif:function(a,b){if(this.listeners[a]){var c=this.listeners[a];c.prevent&&b.preventDefault&&b.preventDefault(),c.invoke(b)}}};var r={init:function(b){if(!a.data(a(this),"mselisteners")){var c=new q;a.data(a(this).get(0),"mselisteners",c),k=new GestureAnalyser(c),a.data(a(this).get(0),"mseAnalyser",k),b&&a.data(a(this).get(0),"mseSrc",b)}return this},destroy:function(){return this.each(function(){a.fn.mseInteraction.prototype.dominateElem==a(this).get(0)&&(a.fn.mseInteraction.prototype.dominateElem=null),a(this).unbind(".mseInteraction"),a.removeData(a(this).get(0),"mselisteners"),MseConfig.mobile&&(a(this).get(0).removeEventListener("touchstart",t,!1),a(this).get(0).removeEventListener("touchend",t,!1),a(this).get(0).removeEventListener("touchmove",t,!1))})},setDominate:function(){return a.fn.mseInteraction.prototype.dominateElem=a(this).get(0),this},cancelDominate:function(){return a.fn.mseInteraction.prototype.dominateElem==a(this).get(0)&&(a.fn.mseInteraction.prototype.dominateElem=null),this},addListener:function(b,c,d){if("string"!=typeof b||!(c instanceof Callback))return!1;var e;if(e=MseConfig.mobile?p:o,null!=e[b]){var f=a.data(a(this).get(0),"mselisteners");if(!f){var g={};f=a.data(a(this).get(0),"mselisteners",g)}if(f.addListener(b,c,d),MseConfig.mobile)for(var h=e[b].split(" "),i=0;h.length>i;i++)a(this).get(0).addEventListener(h[i],t,!1);else a(this).bind(e[b]+".mseInteraction",t)}return this},removeListener:function(b){var c=a.data(a(this).get(0),"mselisteners");return c&&c.removeListener(b),this},setDelegate:function(b){if(!(!b instanceof Callback)){var c;c=MseConfig.mobile?p:o;var d=a.data(a(this).get(0),"mselisteners");if(d){for(var e in c)d.addListener(e,b,!0);return MseConfig.mobile?(a(this).bind("click dblclick taphold swipeleft swiperight.mseInteraction",t),a(this).get(0).addEventListener("touchstart",t,!1),a(this).get(0).addEventListener("touchmove",t,!1),a(this).get(0).addEventListener("touchend",t,!1)):(a(this).bind("click dblclick mousedown mousemove mouseup mousewheel DOMMouseScroll.mseInteraction",t),a(document).bind("keypress keydown keyup.mseInteraction",{target:a(this)},t),d=a.data(a(this).get(0),"mselisteners"),d.addListener("keydown",b),d.addListener("keyup",b),d.addListener("keypress",b)),this}}},setMultiAnalyser:function(a){return a instanceof GestureAnalyser&&(k=null,k=a),this}};a.fn.mseInteraction=function(b){return r[b]?r[b].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof b&&b?(a.error("Method "+b+" does not exist on jQuery.mseInteraction"),this):r.init.apply(this,arguments)},a.fn.mseInteraction.prototype.dominateElem=null}(jQuery),__KEY_DOWN=40,__KEY_UP=38,__KEY_LEFT=37,__KEY_RIGHT=39,__KEY_SPACE=32,function(){var a=!1;MseConfigrationSingleton=function(){this.os=BrowserDetect.OS,this.mobile=-1!=this.os.indexOf("Mobile"),this.iPhone="Mobile/iOS/iPhone"==this.os,this.iPad="Mobile/iOS/iPad"==this.os,this.iOS=-1!=this.os.indexOf("Mobile/iOS"),this.android="Mobile/Android"==this.os,this.browser=BrowserDetect.browser,this.update=function(){this.iPhone||this.android?(this.orientation=window.innerWidth>320?"landscape":"portrait",this.pageWidth=window.innerWidth>320?480:320,this.pageHeight=window.innerWidth>320?268:416):this.mobile?(this.pageWidth=window.innerWidth,this.pageHeight=window.innerHeight):(this.pageWidth=$(window).width(),this.pageHeight=$(window).height())},this.update(),this.mobile?(this.headerH=28,$(window).bind("orientationchange",function(){setTimeout(function(){window.scrollTo(0,1),MseConfig.update(),mse.root&&(mse.root.setCenteredViewport(),MseConfig.mobile&&mse.root.gamewindow.relocate())},50)})):this.headerH=43},window.initMseConfig=function(){a||(window.MseConfig=new MseConfigrationSingleton,a=!0)},$(window).resize(function(){MseConfig.update()})}();
fbapi={},fbapi.user=null,fbapi.connect=function(a){return fbapi.callback=a,fbapi.user?("function"==typeof fbapi.callback&&fbapi.callback.call(window,{status:"connected"}),fbapi.callback=!1,void 0):(FB.login(function(a){"connected"==a.status?(fbapi.token=a.authResponse.accessToken,FB.api("/me",function(b){fbapi.user=b,"function"==typeof fbapi.callback&&fbapi.callback.call(window,a),fbapi.callback=!1})):"not_authorized"===a.status?(alert("Ton compte Facebook ne te permet pas de rejoindre notre site, modifie tes param\u00e8tres."),fbapi.callback=!1):(alert("D\u00e9sol\u00e9, facebook n'a pas \u00e9tabli la connexion, recharger la page et r\u00e9essaye dans quelques minutes"),fbapi.callback=!1)},{scope:"publish_stream,read_stream,email,user_birthday,user_photos,photo_upload"}),void 0)},fbapi.checkConnect=function(a,b){FB.getLoginStatus(function(c){"connected"===c.status?(c.authResponse.userID,fbapi.token=c.authResponse.accessToken,FB.api("/me",function(a){fbapi.user=a}),a&&a.call(this,c)):"not_authorized"===c.status?(fbapi.user=!1,fbapi.token="",a&&a.call(window,c)):(fbapi.user=!1,fbapi.token="",b!==!1&&fbapi.connect(a))})},fbapi.like=function(){FB.getLoginStatus(function(a){"connected"===a.status?FB.api("/me/og.likes","post",{object:document.URL},function(a){if(!a||a.error){if(3501==a.error.code)return window.msgCenter?msgCenter.send("Tu aimes d\u00e9j\u00e0 cette page"):alert("Tu aimes d\u00e9j\u00e0 cette page"),void 0;confirm("Une erreur s'est produite lors de l'envoi. Tu veux r\u00e9essayer ? (Code d'erreur: "+a.error.code+")")&&fbapi.connect(fbapi.like)}else{var b=$("<p>Tu as aim\u00e9 cette page sur Facebook. </p>");fbapi.user&&b.append('<a href="'+fbapi.user.link+'" target="_blank">Voir.</a>'),window.msgCenter?msgCenter.send(b):alert("Tu as aim\u00e9 cette page sur Facebook.")}}):confirm("Il faut \u00eatre connect\u00e9 \u00e0 Facebook pour poster un like. Tu veux te connecter?")&&fbapi.connect(fbapi.like)})},fbapi.post=function(a,b,c,d,e){if(a){b||(b="");var f={url:a,message:b};FB.api("me/photos","POST",f,function(a){return a.id?(FB.api(a.id,function(a){if(!a.source)return e(a);var f={imgUrl:a.source,message:b,fbID:a.id,position:c,ep:mse.configs.epid,fbUserID:a.from.id};$.post(config.base_url+"13comments/comment",f,d,"json")}),void 0):e(a)})}else b&&FB.api("/me/feed","POST",{message:b},function(a){if(!a.id)return e(a);var f={imgUrl:"",message:b,fbID:a.id,position:c,ep:mse.configs.epid,fbUserID:a.id.split("_")[0]};$.post(config.base_url+"13comments/comment",f,d,"json")})},fbapi.postGame=function(a){if(a){var b="J'ai "+(a.result.win?"gagn\u00e9":"perdu")+" le jeu "+a.config.title+" en regardant Voodoo Connection, episode "+mse.configs.epid+". Mon score est de "+a.result.score+"! Peux-tu me battre?",c=config.episode.gameExpos?config.episode.gameExpos[a.className]:null;c||(c=config.episode.image);var d={message:b,picture:c,name:a.config.title,link:a.className?config.base_url+"games/"+a.className:document.URL};FB.api("/me/feed","POST",d,function(a){if(a.id)msgCenter.send('<p>Ton resultat de jeu a \u00e9t\u00e9 bien publi\u00e9 sur Facebook. <a href="'+fbapi.user.link+'" target="_blank">Voir.</a></p>');else if(a.error)switch(a.error.code){case 506:msgCenter.send("T'as d\u00e9j\u00e0 post\u00e9 ton score.");break;default:msgCenter.send("Une erreur est survenue lors de l'envoie du message.")}else msgCenter.send("Une erreur est survenue lors de l'envoie du message.")})}},fbapi.commentInit=function(){fbapi.user&&$(".comment_fblike").each(function(){var a=$(this),b=a.data("postid"),c="SELECT%20user_id%20FROM%20like%20WHERE%20object_id%3D"+b+"%20AND%20user_id%3D"+fbapi.user.id,d="/fql?q="+c;FB.api(d,"get",function(b){b&&b.data&&(b.data.length>0?a.text("J'aime plus"):b.error&&console.log("Error: "+b.error.message))})})},fbapi.commentLike=function(){if(fbapi.user){var a=$(this),b=a.data("postid");FB.api("/"+b+"/likes","post",function(a){a===!0?window.msgCenter&&msgCenter.send("You like the post: "+b):a.error&&console.log("Error: "+a.error.message)})}};
var cart=function(a){function f(a){if("debug"==config.readerMode){var b=window.open("_blank");b.document.write(a.responseText)}}function g(a){c.fadeOut(function(){c.html(a),c.fadeIn(),h()})}function h(){var a=c.children(".cart_product").length;a>0?e.text(a).fadeIn():e.fadeOut()}var b=a,c=null,d=null,e=null;return $(document).ready(function(){c=$("#cart_dialog .cart_container"),d=$("#cart"),e=d.children("span"),d.click(b.show),c.on("click",".remove_product button",function(){var c=$(this).parents(".cart_product");c.length>0&&b.remove(c.data("productref"),c.data("cartpid"),c)}),h(),c.on("click",".click_to_offer",b.offerclicked)}),a.show=function(a){$(".dialog").removeClass("show"),$("#cart_dialog").addClass("show");var b=a instanceof jQuery.Event?$(this):d;b.siblings(":not(.text_sep_vertical)").addClass("inactive"),b.removeClass("inactive")},a.add=function(a){$.ajax({url:config.base_url+"achat/cart/add",type:"POST",dataType:"html",data:{product_ref:a},success:function(a){g(a),b.show()},error:f})},a.remove=function(a,c){$.ajax({url:config.base_url+"achat/cart/remove",type:"POST",dataType:"html",data:{product_ref:a,cart_product_id:c},success:function(a){g(a),b.show()},error:f})},a.offer=function(a,c){$.ajax({url:config.base_url+"achat/cart/offer",type:"POST",dataType:"html",data:{offer_target:c,cart_product_id:a},success:function(a){g(a),b.show()},error:f})},a.offerclicked=function(){var c=$(this).parents(".cart_product");if(c.length>0){var d=$(this).parent();$(this).replaceWith('<input type="email" placeholder="Adresse email"/><button>Confirme</button>'),d.children("button").click(function(){var b=d.children("input").val();b&&""!=b&&a.offer(c.data("cartpid"),b)})}},a}({});
function hideDialog(a){a.removeClass("show"),a.prop("id"),$("#conn li").removeClass("inactive")}function showSignup(){$(".dialog").removeClass("show"),$("#signup_dialog").addClass("show");var a=$("#open_signup");a.siblings(":not(.text_sep_vertical)").addClass("inactive"),a.removeClass("inactive"),addCountries($("#signupPays"))}function showLogin(){$(".dialog").removeClass("show"),$("#login_dialog").addClass("show");var a=$("#open_login");a.siblings(":not(.text_sep_vertical)").addClass("inactive"),a.removeClass("inactive")}function showChPass(){$(".dialog").removeClass("show"),$("#change_pass_dialog").addClass("show"),$("#change_pass_dialog").find("cite").text("").removeClass("alert");var a=$("#open_login");a.siblings(":not(.text_sep_vertical)").addClass("inactive"),a.removeClass("inactive")}function showLinkFb(){$(".dialog").removeClass("show"),$("#link_fb_dialog").addClass("show"),$("#link_fb_dialog").find("cite").text("").removeClass("alert");var a=$("#open_login");a.siblings(":not(.text_sep_vertical)").addClass("inactive"),a.removeClass("inactive")}function showUpdate(){$(".dialog").removeClass("show"),$("#update_dialog").addClass("show");var a=$("#user_id");a.siblings(":not(.text_sep_vertical)").addClass("inactive"),a.removeClass("inactive"),addCountries($("#updatePays"))}function addCountries(a){if(2>a.children().length&&config.countries)for(var b in config.countries)a.append('<option value="'+b+'">'+config.countries[b]+"</option>")}function monthChanged(){var a=parseInt($("#signupbMonth").val()),b=parseInt($("#signupbDay").val()),c="",d=[4,6,9,11],e=30;if(2==a)var e=28;else if(-1!=$.inArray(a,d))var e=30;else e=31;for(var f=1;e>=f;++f)c+="<option value='"+f+"'>"+f+"</option>";$("#signupbDay").html(c),e>=b&&$("#signupbDay").val(b)}function updateMonthChanged(){var a=parseInt($("#updatebMonth").val()),b=parseInt($("#updatebDay").val()),c="",d=[4,6,9,11],e=30;if(2==a)var e=28;else if(-1!=$.inArray(a,d))var e=30;else e=31;for(var f=1;e>=f;++f)c+="<option value='"+f+"'>"+f+"</option>";$("#updatebDay").html(c),e>=b&&$("#updatebDay").val(b)}(function(){function b(){hideDialog($(this).parents(".dialog"))}function c(){function d(a){if("not_authorized"===a.status)return alert("Ton compte Facebook ne te permet pas de rejoindre notre site"),void 0;var b=fbapi.token;$.ajax({url:config.publicRoot+"base/login_fb",type:"POST",dataType:"json",data:{fb_token:b},success:function(a){if(a.valid)document.location.reload();else{switch(a.errorCode){case 10:case 11:break;case 12:showLinkFb(),a.errorMessage=""}a.errorMessage&&""!=a.errorMessage&&alert("Erreur de connexion: "+a.errorMessage),$("input[type=submit]").removeAttr("disabled")}},error:function(){alert("D\u00e9sol\u00e9, une erreur inconnue s'est produite, tu peux nous contacter: contact@encrenomade.com"),$("input[type=submit]").removeAttr("disabled")}})}$("#open_signup").click(showSignup),$("#toSignup").click(showSignup),$("#open_login").click(showLogin),$("#toLogin").click(showLogin),$("#dialog_mask").click(hideDialog),$("#user_id").click(showUpdate),$("#signupbMonth").change(monthChanged),$("#updatebMonth").change(updateMonthChanged),$(".dialog .close").unbind("click",b).click(b),$(".flash-close").click(function(){var a=$(this).parent(".flash-alert");a.fadeOut(500),setTimeout(function(){a.remove()},500)});var c={type:"POST",dataType:"json",success:function(a){a.valid?document.location.reload():(a.errorType&&("mail"==a.errorType?$("#signupMail").siblings("label").addClass("alert"):"pseudo"==a.errorType&&$("#signupId").siblings("label").addClass("alert")),a.errorMessage&&alert("Erreur d'inscription: "+a.errorMessage),$("input[type=submit]").removeAttr("disabled"))},error:function(){alert("D\u00e9sol\u00e9, une erreur inconnue s'est produite, tu peux nous contacter: contact@encrenomade.com"),$("input[type=submit]").removeAttr("disabled")}};$("#signupForm").ajaxForm(c),$("#signupBtn").click(function(b){$("#signupForm").find("cite, label").removeClass("alert");var c=$("#signupId").val(),d=$("#signupPass").val(),e=$("#signupConf").val();$("#signupSex").val();var g=$("#signupbDay").val()+"/"+$("#signupbMonth").val()+"/"+$("#signupbYear").val();$("#signupBirthday").val(g);var h=$("#signupMail").val();$("#signupPays").val();var j=$("#signupCP").val(),k=$("#signupPortable").val();$("#signupNotif").val();var m=!0;""==c&&($("#signupId").siblings("cite").addClass("alert"),m=!1),""==d?($("#signupPass").siblings("cite").addClass("alert"),m=!1):6>d.length&&($("#signupPass").siblings("cite").addClass("alert"),m=!1),(""==e||e!=d)&&($("#signupConf").siblings("cite").addClass("alert"),m=!1),a.mail.test(h)||($("#signupMail").siblings("label").addClass("alert"),m=!1),""==k||a.telephone.test(k)||($("#signupPortable").siblings("cite").addClass("alert"),m=!1),""==j||a.codpos.test(j)||($("#signupCP").siblings("label").addClass("alert"),m=!1),m||b.preventDefault(),$("input[type=submit]",this).attr("disabled","disabled"),$("#signupForm").each(function(){fuel_set_csrf_token(this)})}),$("#signupForm .fb_btn").click(function(){FB.login(function(a){if("connected"==a.status){var b=a.authResponse.accessToken;FB.api("me",function(a){$("#signupId").val(a.username),$("#signupSex").val("male"==a.gender?"m":"f");var c=a.birthday.split("/");$("#signupbDay").val(c[1]),$("#signupbMonth").val(c[0]),$("#signupbYear").val(c[2]),$("#signupMail").attr("readonly","readonly").val(a.email),$("#signup_fbToken").val(b),alert("Compl\u00e8te ton formulaire d'inscription pour t'inscrire")})}else"not_authorized"===a.status?alert("Ton compte Facebook ne te permet pas de rejoindre notre site"):alert("D\u00e9sol\u00e9, une erreur inconnue s'est produite, veuilles recharger la page et r\u00e9essayer")},{scope:"publish_stream,read_stream,email,user_birthday,user_photos,photo_upload"})}),$("#loginForm .fb_btn").click(function(){fbapi.connect(d)});var c={type:"POST",dataType:"json",success:function(a){if(a.valid)return alert("F\u00e9licitation, d\u00e9sormais tu peux te connecter avec ton compte Facebook."),document.location.reload(),void 0;switch(a.errorCode){case 1:$("#linkfbPass").siblings("label").addClass("alert"),$("#linkfbId").siblings("label").addClass("alert");break;case 2:$("#linkfbId").siblings("label").addClass("alert");break;case 3:$("#linkfbPass").siblings("label").addClass("alert");break;case 10:case 11:case 13:alert(a.errorMessage),document.location.reload();break;default:alert("D\u00e9sol\u00e9, une erreur inconnue s'est produite, veuilles recharger la page et r\u00e9essayer")}$("input[type=submit]").removeAttr("disabled")},error:function(){alert("D\u00e9sol\u00e9, une erreur inconnue s'est produite, tu peux nous contacter: contact@encrenomade.com"),$("input[type=submit]").removeAttr("disabled")}};$("#linkFbForm").ajaxForm(c),$("#linkfbBtn").click(function(a){$("#linkFbForm").find("cite, label").removeClass("alert");var b=$("#linkfbId").val(),c=$("#linkfbPass").val(),d=!0;return""==b&&($("#linkfbId").siblings("label").addClass("alert"),d=!1),""==c&&($("#linkfbPass").siblings("label").addClass("alert"),d=!1),d?($("#linkfbToken").prop("value",fbapi.token),$("input[type=submit]",this).attr("disabled","disabled"),fuel_set_csrf_token($("#linkFbForm").get(0)),void 0):(a.preventDefault(),void 0)}),$("#loginForm").submit(function(a){a.preventDefault();var b=$("#loginId").val(),c=$("#loginPass").val(),d=!0;if(""==b&&($("#loginId").siblings("label").addClass("alert"),d=!1),""==c&&($("#loginPass").siblings("label").addClass("alert"),d=!1),d){$("input[type=submit]",this).attr("disabled","disabled");var e={identifiant:b,password:c};$.ajax({url:config.publicRoot+"base/login_normal",dataType:"json",type:"POST",data:e,success:function(a){a.valid?document.location.reload():(a.errorMessage&&alert("Erreur de connexion: "+a.errorMessage),$("input[type=submit]").removeAttr("disabled"))},error:function(){alert("D\u00e9sol\u00e9, une erreur inconnue s'est produite, tu peux nous contacter: contact@encrenomade.com"),$("input[type=submit]").removeAttr("disabled")}})}});var c={type:"POST",dataType:"json",success:function(a){a.valid?($("#chpass_mail").siblings("cite").text("Ton nouveau mot de passe a \u00e9t\u00e9 envoy\u00e9."),alert("Ton nouveau mot de passe a \u00e9t\u00e9 envoy\u00e9."),hideDialog($("#change_pass_dialog")),$("input[type=submit]").removeAttr("disabled")):($("#chpass_mail").siblings("cite").text(a.errorMessage).addClass("alert"),$("input[type=submit]").removeAttr("disabled"))},error:function(){$("#chpass_mail").siblings("cite").text("D\u00e9sol\u00e9, une erreur inconnue s'est produite, tu peux nous contacter: contact@encrenomade.com").addClass("alert"),$("input[type=submit]").removeAttr("disabled")}};$("#chPassForm").ajaxForm(c),$("#chPassBtn").click(function(){$("#chPassForm").find("cite, label").removeClass("alert"),$("input[type=submit]",this).attr("disabled","disabled"),fuel_set_csrf_token($("#chPassForm").get(0))});var c={type:"POST",dataType:"json",success:function(a){a.valid?document.location.reload():(a.errorType&&"password"==a.errorType&&$("#updateOldPass").siblings("label").addClass("alert"),a.errorMessage&&alert("Erreur de la mise \u00e0 jour: "+a.errorMessage),$("input[type=submit]").removeAttr("disabled"))},error:function(){alert("D\u00e9sol\u00e9, une erreur inconnue s'est produite, tu peux nous contacter: contact@encrenomade.com"),$("input[type=submit]").removeAttr("disabled")}};$("#updateForm").ajaxForm(c),$("#updateBtn").click(function(b){$("#updateForm").find("cite, label").removeClass("alert");var c=$("#updatePass").val(),d=$("#updateConf").val();$("#updateSex").val();var f=$("#updatebDay").val()+"/"+$("#updatebMonth").val()+"/"+$("#updatebYear").val();$("#updateBirthday").val(f),$("#updatePays").val();var h=$("#updateCP").val(),i=$("#updatePortable").val();$("#updateNotif").val();var k=$("#updateOldPass").val(),l=!0;""!=c&&6>c.length&&($("#updatePass").siblings("cite").addClass("alert"),l=!1),""!=d&&d!=c&&($("#updateConf").siblings("cite").addClass("alert"),l=!1),""==h||a.codpos.test(h)||($("#updateCP").siblings("label").addClass("alert"),l=!1),""==i||a.telephone.test(i)||($("#updatePortable").siblings("cite").addClass("alert"),l=!1),""==k&&($("#updateOldPass").siblings("cite").addClass("alert"),l=!1),l||b.preventDefault(),$("input[type=submit]",this).attr("disabled","disabled"),fuel_set_csrf_token($("#updateForm").get(0))}),$("#logout").click(function(){$.ajax({url:config.publicRoot+"base/logout",dataType:"json",type:"GET",success:function(a){a.valid?document.location.reload():(a.errorMessage&&alert("Erreur de d\u00e9connexion: "+a.errorMessage),$("input[type=submit]").removeAttr("disabled"))},error:function(){alert("D\u00e9sol\u00e9, une erreur inconnue s'est produite, tu peux nous contacter: contact@encrenomade.com"),$("input[type=submit]").removeAttr("disabled")}})})}var a={date:/^\d{2}\/\d{2}\/\d{4}$/,mail:/^[\w\.\_\-]+@[\w\.\_\-]+$/,telephone:/^[\d]+$/,errcode:/\d{4}/g,codpos:/^[\d]+$/};$(document).ready(c)})();
var msgCenter=function(){function e(a){a.addClass("fadeIn")}function f(a){a.removeClass("fadeIn")}function g(b){b.remove(),0==a.list.children("li").length&&a.box.detach()}function h(a,b){b=isNaN(b)?0:Math.abs(b);var c=setTimeout(function(){f(a)},b),d=setTimeout(function(){g(a),a=null},b+1e3);return[c,d]}function i(a){setTimeout(function(){e(a),a=null},1)}var a={},b={},c=5;a.box=$('<div id="msgCenter"><ul></ul></div>'),a.list=a.box.children("ul"),b.box=$('<div id="msgCenterStatic"><h1></h1><ul></ul></div>'),b.list=b.box.children("ul"),b.visible=!1;var j={target:b.box,x:0,y:0,moving:!1};b.box.children("h1").mousedown(function(a){j.moving||(j.x=a.pageX,j.y=a.pageY,j.moving=!0,j.target.addClass("moving"),$(document).bind("mousemove",k)),a.preventDefault()});var k=function(a){if(j.moving){var b=a.pageX-j.x,c=a.pageY-j.y,d={left:j.target.offset().left,bottom:parseInt(j.target.css("bottom"))};j.target.css({left:d.left+b,bottom:d.bottom-c}),j.x=a.pageX,j.y=a.pageY}};$(document).mouseup(function(){j.moving&&(j.moving=!1,j.target.removeClass("moving"),$(document).unbind("mousemove",k))});var l=new function(){};return l.send=function(b,c){0==a.list.children("li").length&&a.box.prependTo("body");var d=$("<li></li>");return d.append(b),a.list.prepend(d),i(d),0===c||"fixed"===c?d:(c=isNaN(c)?3e3:c,this.closeMessage(d,c),d)},l.getList=function(){return a.list},l.getMax=function(){return c},l.closeMessage=function(b,d){if(1===b.parents("#msgCenterStatic").length)return b.remove(),void 0;d=isNaN(d)?0:d;var e=h(b,d);MseConfig.mobile&&b.hover(function(){clearTimeout(e[0]),clearTimeout(e[1])},function(){e=h(b)}),a.list.children("li").each(function(a){a>=c&&h($(this))})},l.getStaticBox=function(){return b.box},l.showStaticBox=function(a,c){b.list.html(" "),a&&""!=a||(a="Notifications"),b.box.children("h1").html(a),b.box.prependTo("body");var d=b.box.get(0);d.style.removeProperty("left"),d.style.removeProperty("bottom"),d.style.removeProperty("width"),"object"==typeof c&&(isNaN(c.width)||b.box.css("width",c.width),isNaN(c.bottom)||b.box.css("bottom",c.bottom),isNaN(c.left)||b.box.css("left",c.left),isNaN(c.right)||b.box.css("right",c.right)),b.visible=!0},l.closeStaticBox=function(){b.list.html(" "),b.box.detach(),b.visible=!1},l.sendToStatic=function(a){b.visible||this.showStaticBox();var c=$("<li></li>");return c.append(a),b.list.prepend(c),c},l}();
function story_access_resp(a){if(!a.valid&&null!=a.errorCode)switch(a.errorCode){case 201:showLogin&&showLogin();break;case 302:showLogin&&showLogin();break;case 303:gui.hideConcept(),accessGateway.ep3(a);break;case 304:gui.hideConcept(),accessGateway.ep4(a);break;case 202:case 102:case 101:default:a.errorMessage&&""!=a.errorMessage&&msgCenter.send(a.errorMessage,1e4)}}function constructDomComment(a){if(!a)return $("");var b=new Date(1e3*a.date);b.getDate()+"/"+(b.getMonth()+1);var d="<li>";return d+='<img class="comment_avatar" src="'+a.avatar+'"/>',d+='<div class="comment_body">',d+='<div class="arrow"></div>',d+="<h5>"+a.content+"</h5>",d+=""!=a.image?'<img class="comment_image" src="'+a.image+'"/>':"",d+='<div class="comment_footer">',d+="<h5>De "+a.user+"</h5>",a.fbpostid&&(d+='<a class="comment_fblike" data-postid="'+a.fbpostid+'"></a>',d+='<a class="comment_fblink" href="http://www.facebook.com/'+a.fbpostid+'" target="_blank"></a>'),d+="</div>",d+="</div>",d+="</li>",$(d)}var mmvc=function(){var observe=function(a,b){this._mmvclisteners[a].push(b)},notify=function(a,b){for(var c=this._mmvclisteners[a],d=0;c.length>d;++d)c[d].invoke(b)},addObservableVars=function(vars){if(vars instanceof Array)for(var i=0;vars.length>i;++i){var variable=vars[i];this["set"+variable]?this._mmvclisteners[variable]||(this._mmvclisteners[variable]=[]):(this._mmvclisteners[variable]||(this._mmvclisteners[variable]=[]),eval("this.set"+variable+" = function(value) {this."+variable+" = value; this.notify('"+variable+"', value);}"))}};return{makeModel:function(a,b){if(a instanceof Object){if(a.notify||a.observe||a.addObservableVars)return console.error("Model has his own observe, notify and/or addObservableVars method"),void 0;a._mmvclisteners={},a.observe=observe,a.notify=notify,a.addObservableVars=addObservableVars,a.addObservableVars(b)}}}}(),accessGateway={success:!1,buyClicked:function(a,b){var c=confirm("MERCI\nTu es l\u2019un de nos premiers clients. Pour te remercier, nous t\u2019offrons gratuitement le "+a+"e\u0300me e\u0301pisode de Voodoo Connection.");c&&(b&&$.ajax({url:window.config.base_url+b,type:"POST",async:!1,dataType:"json",data:{epid:a}}),window.open(window.config.publicRoot+"story?ep="+a,"_newtab"))},ep3:function(){$("#access_dialog").attr("class","dialog invitation_dialog"),$("#access_dialog h1").text("Invitation");var b=$("#access_dialog");FB.XFBML.parse(),FB.Event.subscribe("message.send",function(){$.ajax({url:window.config.publicRoot+"accessaction/invitation_fb",type:"POST",dataType:"json",success:function(a){a&&a.valid&&a.valid===!0?accessGateway.success=!0:a&&a.errorMessage?alert(a.errorMessage):alert("Une erreur de connexion est survenue.")},error:function(){alert("Une erreur de connexion est survenue.")}}),$("#access_dialog #fbsend_section").nextAll().remove(),$("#access_dialog #fbsend_section").append("<p><input id='send_fb_btn' type='submit' value=\"Acc\u00e8de \u00e0 l'\u00e9pisode 3\"></p>"),$("#send_fb_btn").click(function(a){a.preventDefault(),accessGateway.success&&(accessGateway.success=!1,b.removeClass("show"),window.open(window.config.publicRoot+"Voodoo_Connection/season1/episode3","_newtab"))})});var c={type:"POST",async:!1,dataType:"json",success:function(a){a&&a.valid&&a.valid===!0?(b.removeClass("show"),accessGateway.success=!0):a&&a.errorMessage?alert(a.errorMessage):alert("Une erreur de connexion est survenue.")},error:function(){alert("Une erreur de connexion est survenue.")}};$("#invitation_form").ajaxForm(c),$("#send_mail_btn").click(function(a){a.preventDefault(),fuel_set_csrf_token($("#invitation_form").get(0)),$("#invitation_form").submit(),accessGateway.success&&(accessGateway.success=!1,window.open(window.config.publicRoot+"Voodoo_Connection/season1/episode3","_newtab"))}),b.addClass("show"),$("#access_buy_btn3").unbind("click").click(function(){b.removeClass("show")})},ep4:function(){$("#access_dialog").attr("class","dialog like_dialog"),$("#access_dialog h1").text("J'aime SEASON13 sur Facebook");var b=$("#access_dialog");FB.XFBML.parse(),FB.Event.subscribe("edge.create",function(){$.ajax({url:window.config.publicRoot+"accessaction/liked",type:"POST"}),$("#access_dialog #like_section fb").nextAll().remove(),$("#access_dialog #like_section").append("<p><input id='access_submit_btn4' type='submit' value=\"Acc\u00e8de \u00e0 l'\u00e9pisode 4\"></p>")});var c={type:"POST",async:!1,dataType:"json",success:function(a){a&&a.valid&&a.valid===!0?(b.removeClass("show"),accessGateway.success=!0):a&&a.errorMessage?alert(a.errorMessage):alert("Une erreur de connexion est survenue.")},error:function(){alert("Une erreur de connexion est survenue.")}};$("#like_form").ajaxForm(c),$("#access_submit_btn4").live("click",function(a){a.preventDefault(),fuel_set_csrf_token($("#like_form").get(0)),$("#like_form").submit(),accessGateway.success&&(accessGateway.success=!1,window.open(window.config.publicRoot+"Voodoo_Connection/season1/episode4","_newtab"))}),fbapi.connect(function(){var a=fbapi.user.id,b='SELECT%20user_id%20FROM%20url_like%20WHERE%20url%3D"http://season13.com/"%20AND%20user_id%3D'+a,c="/fql?q="+b;FB.api(c,"get",function(a){a&&a.data&&(a.data.length>0?$("#access_dialog #like_section").html("<h5>Bravo! Tu as d\u00e9j\u00e0 aim\u00e9 SEASON13 sur Facebook, nous t'offrons le 4\u00e8me \u00e9pisode de Voodoo Connection.<br/></h5><p><input id='access_submit_btn4' type='submit' value=\"Acc\u00e8de \u00e0 l'\u00e9pisode 4\"></p>").nextAll().remove():a.error&&console.log("Error: "+a.error.message))})}),b.addClass("show"),$("#access_buy_btn4").unbind("click").click(function(){$(".center #access_dialog").removeClass("show")})}};gui={},gui.Slider=function(a,b,c,d){this.jqObj=$("<div class='slider'></div>"),this.line=$("<div class='line'></div>"),this.btn=$("<div class='ctrlbtn'></div>"),this.back=$("<img class='background' src='"+config.base_url+"assets/img/season13/ui/slider_back.png'/>"),this.jqObj.append(this.back).append(this.line).append(this.btn),isNaN(a)||this.jqObj.css("width",a),this.width=this.jqObj.width()-this.btn.width(),this.level=isNaN(b)?100:b,this.step=this.width/(this.level-1),this.value=0,this.ondrag=!1,this.appendTo(c),this.dragStartHandlerCB=new Callback(this.dragStartHandler,this),this.draggingHandlerCB=new Callback(this.draggingHandler,this),this.moveBtnCB=new Callback(this.moveBtn,this),mmvc.makeModel(this,["value"]),this.observe("value",this.moveBtnCB),isNaN(d)&&(d=0),this.setvalue(d),this.btn.mseInteraction().mseInteraction("addListener","gestureSingle",this.dragStartHandlerCB,!0),this.back.mseInteraction().mseInteraction("addListener","gestureSingle",this.draggingHandlerCB,!0)},gui.Slider.prototype={constructor:gui.Slider,appendTo:function(a){return this.jqObj&&a instanceof jQuery?(a.append(this.jqObj),this.jqObj.css({top:(a.height()-this.jqObj.height())/2}),this.jqObj):null},moveBtn:function(a){var b=a*this.step-9;0>b&&(b=0),this.btn.css("left",b),this.line.css("width",b)},dragStartHandler:function(a){"gestureStart"==a.type?this.startDrag(a):"gestureUpdate"==a.type?this.dragging(a):"gestureEnd"==a.type&&this.endDrag(a)},draggingHandler:function(a){"gestureUpdate"==a.type?this.dragging(a):"gestureEnd"==a.type&&this.endDrag(a)},startDrag:function(){this.ondrag=!0},dragging:function(a){if(this.ondrag){var b=a.windowX-this.back.offset().left;b>this.width?b=this.width:0>b&&(b=0);var c=Math.ceil(b/this.step);this.setvalue(c)}},endDrag:function(){this.ondrag=!1}},gui.downloadTimeout=function(){},gui.removeDownloadTimer=function(a){a=a?a:gui.downloadTimer,clearTimeout(a)},gui.openhideMenu=function(a){a.stopPropagation(),gui.menu.hasClass("active")?(gui.menu.removeClass("active"),$("#icon_menu").removeClass("active"),$("#switch_menu").removeClass("active")):(gui.menu.addClass("active"),$("#icon_menu").addClass("active"),$("#switch_menu").addClass("active"))},gui.openPref=function(){gui.center.hasClass("show")||gui.center.addClass("show"),gui.pref.hasClass("show")||(gui.pref.siblings().removeClass("show"),gui.pref.addClass("show"),window.mse&&(mse.root.pause(),gui.updatePlayPauseIcon()))},gui.savePersonalData=function(){mse.configs.user?(gui.prefSaveLoading.show(),userData.save(function(){msgCenter.send("Tes configurations sont mise \u00e0 jour."),gui.prefSaveLoading.hide()},function(){msgCenter.send("\u00c9chec de sauvegarder tes configurations."),gui.prefSaveLoading.hide()})):alert("Tu dois \u00eatre connect\u00e9 pour pouvoir sauvegarder.")},gui.openAuthorBio=function(){gui.center.hasClass("show")||gui.center.addClass("show"),gui.author_bio.hasClass("show")||(gui.author_bio.siblings().removeClass("show"),gui.author_bio.addClass("show"),window.mse&&(mse.root.pause(),gui.updatePlayPauseIcon()))},gui.openCredits=function(){gui.center.hasClass("show")||gui.center.addClass("show"),gui.credits.hasClass("show")||(gui.credits.siblings().removeClass("show"),gui.credits.addClass("show"),window.mse&&(mse.root.pause(),gui.updatePlayPauseIcon()))},gui.openNextEp=function(){var a=$("#next_ep_dialog");gui.center.hasClass("show")||gui.center.addClass("show"),a.hasClass("show")||(a.siblings().removeClass("show"),a.addClass("show"),window.mse&&(mse.root.pause(),gui.updatePlayPauseIcon()))},gui.hideConcept=function(){gui.concept.removeClass("show");var a=!1;gui.center.children().each(function(){$(this).hasClass("show")&&(a=!0)}),a||gui.center.removeClass("show")},gui.openhideUploader=function(a){a&&a.stopPropagation(),gui.uploader.hasClass("show")?(gui.comment.unbind("click",gui.openhideUploader),gui.uploader.removeClass("show")):(gui.uploader.addClass("show"),gui.comment.click(gui.openhideUploader))},gui.updatePlayPauseIcon=function(){mse.root.inPause?gui.playpause.html('<img src="'+config.base_url+'assets/img/season13/ui/wheel_play.png"/>'):gui.playpause.html('<img src="'+config.base_url+'assets/img/season13/ui/wheel_pause.png"/>')},gui.isToolsOpen=function(){return gui.fblike.hasClass("active")},gui.openhideTools=function(){var a=gui.controler.find("li");a.eq(1).hasClass("active")?(a.removeClass("active"),$(this).removeClass("active")):(a.addClass("active"),$(this).addClass("active"))},gui.openComment=function(){gui.center.hasClass("show")||gui.center.addClass("show"),gui.comment.hasClass("show")||(gui.comment.addClass("show"),gui.comment.siblings().removeClass("show"),mse.root.pause(),gui.updatePlayPauseIcon(),0==gui.userComments.children("li").length&&gui.updateUsersComments(0))},gui.closeComment=function(){gui.comment_loading.removeClass("show"),gui.comment_menu.children("#commentImg").remove(),gui.comment_content.val("")},gui.updateUsersComments=function(a){a=isNaN(a)?gui.userComments.children("li").length:a,$.ajax({type:"GET",url:config.base_url+"13comments/comment_by_ep",data:{start:a,ep:mse.configs.epid},dataType:"json",success:function(a){if(a)if(0==a.success)a.errorMessage&&msgCenter.send(a.errorMessage);else if(1==a.success&&$.isArray(a.comments)){var e=a.comments;if(0==e.length)gui.userComments.children("#renew_comments").text("Plus d'anciens commentaires").unbind("click");else{for(var f=$(""),g=0;e.length>g;++g){var h=e[g];f=f.add(constructDomComment(h))}gui.userComments.children("#renew_comments").before(f)}}else{var d=$("<h5>Echec de r\u00e9cup\u00e9rer les commentaires</h5>");gui.userComments.children("#renew_comments").before(d),d.delay(1e3).fadeOut(400,function(){d.remove()})}else{var d=$("<h5>Echec de r\u00e9cup\u00e9rer les commentaires</h5>");gui.userComments.children("#renew_comments").before(d),d.delay(1e3).fadeOut(400,function(){d.remove()})}}})},gui.setCommentImage=function(a,b){"base64"!=b&&"path"!=b&&(b="path");var c=gui.comment_menu.children("#commentImg");0==c.length?(c=$('<li id="commentImg"><img class="preview" src="'+a+'"/></li>'),gui.comment_menu.append(c)):c.children("img").prop("src",a),c.children("img").attr("type",b),c.hide().fadeIn(500)},gui.postComment=function(a,b){function d(a){if(a)if(a.success){var b=a.posted;gui.userComments.prepend(constructDomComment(b)),gui.userComments.scrollTop(-gui.userComments.position().top),gui.comment_loading.removeClass("show");var c=null;c=fbapi.user&&gui.fbShareEnabled&&"0"!=b.fbpostid?$('<p>Ton message a bien \u00e9t\u00e9 post\u00e9 sur SEASON13 et sur Facebook. <a href="'+fbapi.user.link+'" target="_blank">Voir.</a></p>'):$("<p>Ton message a bien \u00e9t\u00e9 post\u00e9.</p>"),msgCenter.send(c)}else gui.comment_loading.removeClass("show"),msgCenter.send(a.errorMessage);else f(a,e)}function f(){"debug"==config.readerMode&&(console.log("ERROR WHILE POSTING COMMENT : "),console.log(arguments)),gui.comment_loading.removeClass("show"),msgCenter.send("Une erreur est survenue. Lors de l'envoie ou la recup\u00e9ration du commentaire.")}var c=JSON.stringify(mse.root.getProgress());return fbapi.user&&gui.fbShareEnabled?fbapi.post(a,b,c,d,f):(a?(null==b&&(b=""),$.post(config.base_url+"13comments/comment",{imgUrl:a,message:b,position:c,fbID:"",ep:mse.configs.epid},d,"json")):b&&$.post(config.base_url+"13comments/comment",{imgUrl:"",message:b,position:c,fbID:"",ep:mse.configs.epid},d,"json"),void 0)},$(document).ready(function(){if(initMseConfig(),gui.menu=$("#menu"),gui.center=$("#center"),gui.pref=$("#preference"),gui.prefSaveLoading=$("#preference .link .loading").hide(),gui.author_bio=$("#author_bio"),gui.credits=$("#credits"),gui.controler=$("#controler"),gui.comment=$("#comment"),gui.comment_menu=$("#comment_menu"),gui.comment_content=$("#comment_content"),gui.comment_loading=gui.comment.children(".loading"),gui.comment_share_btn=gui.comment_menu.children("#btn_share"),gui.userComments=$("#comment_list"),gui.uploader=$("#upload_container"),gui.uploadForm=$("#imageuploadform"),gui.playpause=$("#ctrl_playpause"),gui.speedup=$("#controler #ctrl_speedup"),gui.slowdown=$("#controler #ctrl_slowdown"),gui.commentbtn=$("#controler #ctrl_comment"),gui.fblike=$("#controler #ctrl_like"),gui.concept=$("#concept"),gui.currPlayState=!0,gui.fbShareEnabled=!0,gui.scriber&&$("#scriber").length>0&&gui.scriber.init(),gui.center.children().children(".close").click(function(){$(this).parent().removeClass("show"),mse.root.play(),gui.updatePlayPauseIcon();var a=!1;gui.center.children().each(function(){$(this).hasClass("show")&&(a=!0)}),a||gui.center.removeClass("show")}),gui.comment.children(".close").click(gui.closeComment),$("#icon_menu, #sep_right, #switch_menu").click(gui.openhideMenu),$("#btn_param").click(gui.openPref),gui.audioctrl=new gui.Slider(200,100,gui.pref.children("p:first"),50),gui.speedctrl=new gui.Slider(200,10,gui.pref.children("p:eq(1)"),5),gui.audioctrl.jqObj.css("left",70),gui.speedctrl.jqObj.css("left",70),window.mse&&(gui.audioctrl.observe("value",new Callback(mse.src.setVolume,mse.src)),mse.ArticleLayer.prototype.observe("speedLevel",new Callback(function(a){gui.speedctrl.setvalue(a)},null)),gui.speedctrl.observe("value",new Callback(function(a){mse.ArticleLayer.prototype.speedLevel=a},null))),$("#btn_author").click(gui.openAuthorBio),$("#btn_credits").click(gui.openCredits),$("#btn_nextep").click(gui.openNextEp),window.mse){gui.controler.children("#circle").click(gui.openhideTools);var b,a=gui.controler.children("#circle").children("span");gui.playpause.click(function(){mse.root.inPause?mse.root.play():mse.root.pause(),gui.currPlayState=!mse.root.inPause,gui.updatePlayPauseIcon()}),gui.speedup.click(function(){var c=mse.ArticleLayer.prototype.speedLevel+1;mse.ArticleLayer.prototype.setspeedLevel(c),a.text(c),b&&clearTimeout(b),a.animate({opacity:1},300),b=setTimeout(function(){a.animate({opacity:0},300)},1600)}),gui.slowdown.click(function(){var c=mse.ArticleLayer.prototype.speedLevel-1;mse.ArticleLayer.prototype.setspeedLevel(c),a.text(c),b&&clearTimeout(b),a.animate({opacity:1},300),b=setTimeout(function(){a.animate({opacity:0},300)},1600)}),$("#ctrl_like").click(function(){fbapi.like()}),gui.commentbtn.click(gui.openComment),gui.userComments.on("click",".comment_fblike",fbapi.commentLike),gui.pref.find("#share_comment_fb").change(function(){gui.fbShareEnabled=$(this).prop("checked"),gui.fbShareEnabled?gui.comment_share_btn.children("img").show():gui.comment_share_btn.children("img").hide()}),gui.comment_menu.children("#btn_capture_img").click(function(){gui.comment.removeClass("show"),mse.root.startCapture(new Callback(gui.scriber.showWithImg,gui.scriber))}),gui.comment_menu.children("#btn_upload_img").click(gui.openhideUploader),gui.uploader.click(function(a){a.stopPropagation()});var c={type:"POST",url:config.restUploadPath+"create_img",dataType:"json",success:function(a){gui.comment_loading.removeClass("show"),gui.uploadForm.get(0).reset(),gui.openhideUploader(),a.success?gui.setCommentImage(a.path,"path"):a.errorMessage&&msgCenter.send(a.errorMessage)},error:function(){gui.comment_loading.removeClass("show"),gui.uploadForm.get(0).reset(),gui.openhideUploader(),msgCenter.send("Erreur de t\u00e9l\u00e9chargement")}};gui.uploadForm.ajaxForm(c),$("#imageuploadform #upload_btn").click(function(){if(gui.comment_menu.children("#commentImg").length>0){var a=confirm("Tu vas remplacer l'image pr\u00e9c\u00e9demment t\u00e9l\u00e9charg\u00e9e, s\u00fbr?");if(!a)return}gui.uploadForm.submit(),gui.comment_loading.addClass("show")}),gui.comment_share_btn.click(function(){var a=gui.comment_menu.children("#commentImg").children("img"),b=a.prop("src"),c=a.attr("type");b=b&&""!=b.trim()?b:!1;var d=gui.comment_content.val();if(!b&&""==d)return msgCenter.send("Ton message est vide."),void 0;if(a.parent().remove(),gui.comment_content.val(""),gui.comment_loading.addClass("show"),b&&"base64"==c){var e={imgData64:b};fbapi.user&&(e.fbComment=!0),$.ajax({type:"POST",url:config.restUploadPath+"create_drawing",dataType:"json",data:e,success:function(a){a.success?(b=a.path,gui.postComment(b,d)):(gui.comment_loading.removeClass("show"),a.errorMessage&&msgCenter.send(a.errorMessage))},error:function(){gui.comment_loading.removeClass("show"),msgCenter.send("Erreur de t\u00e9l\u00e9chargement")}})}else gui.postComment(b,d)}),window.mse.root.init||(gui.downloadTimer=setTimeout(gui.downloadTimeout,2e4)),mse.root.evtDistributor.rootEvt.addListener("loadover",new Callback(gui.removeDownloadTimer,gui,gui.downloadTimer)),mse.root.evtDistributor.rootEvt.addListener("loadover",new Callback(gui.hideConcept,gui)),mse.root.evtDistributor.rootEvt.addListener("finished",new Callback(gui.openNextEp,gui))}window.mse&&window.mse.root.init||(gui.concept.addClass("show"),gui.center.addClass("show"))});var userData=function(){function c(a){if("debug"==config.readerMode){var b=window.open("_blank");b.document.open(),b.document.write(a.responseText),b.document.close()}}var a={},b=a;return $(window).unload(function(){a.save()}),$(document).ready(function(){a.retrieve(),$("#game_quit").click(a.save)}),b.save=function(a,b){config.episode&&config.episode.epid&&$.post(config.base_url+"user/data/update",{speed:gui.speedctrl.value,fbShareEnabled:gui.fbShareEnabled,volume:gui.audioctrl.value,epId:config.episode.epid,position:window.mse&&window.mse.root?mse.root.getProgress():{},started:!0,completed:!1}).success("function"==typeof a?a:function(){}).error("function"==typeof b?b:c)},b.retrieve=function(){config.episode&&config.episode.epid&&$.ajax({url:config.base_url+"user/data/retrieve",type:"GET",data:{epId:config.episode.epid},dataType:"json",success:function(a){if(a.config){var b=a.config;b.fbShareEnabled&&gui.pref.find("#share_comment_fb").prop("checked","true"==b.fbShareEnabled?!0:!1),b.speed&&gui.speedctrl.setvalue(parseInt(b.speed)),b.volume&&gui.audioctrl.setvalue(parseInt(b.volume))}},error:c})},b}();
var GameInfo=function(){function d(a){$.ajax({url:config.base_url+"user/data/gameInfo",type:"GET",data:{className:a.className},dataType:"json",success:function(b){b&&b.high_score&&a.setHighScore(b.high_score)},error:f})}function e(a){window.userData&&userData.save(),$.ajax({url:config.base_url+"user/data/gameInfo",type:"POST",data:{className:a.className,score:a.result.score},error:f})}function f(a){if("debug"==config.readerMode){var b=window.open("_blank");b.document.open(),b.document.write(a.responseText),b.document.close()}}var c,a={},b=a;return b.register=function(a){return a.className?(c=a,a.evtDeleg.addListener("end",new Callback(e,this,a)),d(a),void 0):!1},b}();
$(document).ready(function(){window.tuto=new MseScenario;var a=null;window.quitTuto=function(){tuto.quit(),a&&(msgCenter.closeMessage(a),a=null)};var b=function(a){a.data.action.end()},c=[new MseTutoMsg(null,""),new MseTutoMsg(null,""),new MseTutoMsg(null,""),new MseTutoMsg(null,""),new MseTutoMsg(null,"")],d=!1;if(mse&&mse.configs&&(d=mse.configs.isTutoDone),!d&&window.layers)for(var e in layers)if(layers[e]instanceof mse.ArticleLayer){var f=layers[e].getObject(1);f instanceof mse.UIObject&&f.addListener("firstShow",new Callback(function(){gui.playpause.click();var a=$("#lance_tuto");if(a)a.addClass("show"),a.children(".floatlink").first().click(function(){d||$.post(config.publicRoot+"base/has_done_tuto"),a.removeClass("show"),gui.playpause.click()}),a.children(".floatlink").last().click(function(){tuto.reset(),tuto.run(),a.removeClass("show")});else{var b=confirm("Veux-tu d\u00e9marrer le tutoriel ? Sinon, tu peux le d\u00e9marrer plus tard dans le menu en haut \u00e0 droite.");b?(this.reset(),this.run()):($.post(config.publicRoot+"base/has_done_tuto"),gui.playpause.click())}},tuto));break}var g=[new MseAction("BtnMenu",{btn:$("#switch_menu"),endDelay:600},function(){return a=msgCenter.send("Le tutoriel est lanc\u00e9, \u00e0 toi de suivre les indications, tu peux arr\u00eater \u00e0 tout moment en cliquant <a href='javascript:quitTuto();'>ici</a>",0),$.post(config.publicRoot+"base/has_done_tuto"),gui.menu.hasClass("active")?(this.end(),void 0):($("#icon_menu, #sep_right, #switch_menu").click({action:this},b),c[0].reinit(this.btn,"Clique pour ouvrir le menu",{position:"left",animate:!0}).show(),void 0)},function(){c[0].hide(),$("#icon_menu, #sep_right, #switch_menu").unbind("click",b)}),new MseAction("OpenParameters",{btn:$("#btn_param"),endDelay:600},function(){this.btn.click({action:this},b),c[0].reinit(this.btn,"Clique pour configurer les param\u00e8tres",{position:"left",animate:!0}).show()},function(){c[0].hide(),this.btn.unbind("click",b)}),new MseAction("Parameters",{audio:gui.audioctrl.jqObj,speed:gui.speedctrl.jqObj,fbComment:gui.pref.find("#share_comment_fb"),close:gui.pref.children(".close"),fbNotif:function(){c[2].message=$(this).prop("checked")?"Si tu t'es connect\u00e9 avec ton compte Facebook, tes commentaires seront publi\u00e9s sur ton mur":"Vos commentaires ne seront publi\u00e9s que sur Season13"},endDelay:600},function(){c[0].reinit(this.audio,"Volume de son",{position:"top"}).show(),c[1].reinit(this.speed,"Vitesse de d\u00e9filement",{position:"right"}).show(),c[2].reinit(this.fbComment,"Publication de tes commentaires sur Facebook",{position:"bottom"}).show(),c[3].reinit(this.close,"Ferme la fen\u00eatre pour continuer",{position:"bottom",animate:!0}).show(),this.close.click({action:this},b),this.fbComment.change(this.fbNotif)},function(){c[0].hide(),c[1].hide(),c[2].hide(),c[3].hide(),this.fbComment.unbind("change",this.fbNotif),this.close.unbind("click",b),mse.root.pause()}),new MseAction("BtnTools",{btn:gui.controler.children("#circle")},function(){gui.isToolsOpen()&&gui.openhideTools(),this.btn.click({action:this},b),c[0].reinit(this.btn,"Bo\u00eete \u00e0 outils",{position:"right",animate:!0}).show()},function(){c[0].hide(),this.btn.unbind("click",b)}),new MseAction("Like",{beginDelay:500,btn:gui.fblike,endDelay:600},function(){gui.isToolsOpen()||gui.openhideTools(),this.btn.click({action:this},b),c[0].reinit(this.btn,"J'aime l'\u00e9pisode, ou <a href='javascript:tuto.passNext();'>passe</a>").show()},function(){c[0].hide(),this.btn.unbind("click",b)}),new MseAction("Speedup",{btn:gui.speedup,circle:gui.controler.children("#circle"),endDelay:2e3},function(){gui.isToolsOpen()||gui.openhideTools(),this.btn.click({action:this},b),c[0].reinit(this.btn,"Lecture plus rapide").show()},function(){this.btn.unbind("click",b),c[0].reinit(this.circle,"Ta vitesse de lecture").show()}),new MseAction("Slowdown",{btn:gui.slowdown,endDelay:600},function(){gui.isToolsOpen()||gui.openhideTools(),this.btn.click({action:this},b),c[0].reinit(this.btn,"Lecture plus lente").show()},function(){c[0].hide(),this.btn.unbind("click",b)}),new MseAction("Comment",{btn:gui.commentbtn,endDelay:600},function(){gui.isToolsOpen()||gui.openhideTools(),this.btn.click({action:this},b),c[0].reinit(this.btn,"Laisse un commentaire pour tes amis").show()},function(){c[0].hide(),this.btn.unbind("click",b)}),new MseAction("CommentDialog",{content:gui.comment_content,comments:gui.userComments,endDelay:600},function(){gui.openComment(),c[0].reinit(this.content,"\u00c9cris ton commentaire ici",{position:"center"}).show(),c[1].reinit(this.comments,"Les commentaire des autres utilisateurs",{position:"center"}).show();var a=this;setTimeout(function(){a.end()},5e3)},function(){c[0].hide(),c[1].hide()}),new MseAction("CommentMenu",{menu:gui.comment_menu,btn:gui.comment_menu.children("#btn_capture_img"),endDelay:600},function(){gui.openComment(),c[0].reinit(this.btn,"Capture une image",{animate:!0,position:"bottom"}).show(),this.btn.click({action:this},b)},function(){c[0].hide(),this.btn.unbind("click",b)}),new MseAction("ChooseZone",{root:mse.root.jqObj,endDelay:600},function(){c[0].reinit(this.root,"Capture une image en appuyant sur le bouton gauche de la souris",{position:"center"}).show(),this.end()}),new MseAction("CaptureDialog",{scriber:gui.scriber.jq,preventEvent:function(a){a.stopImmediatePropagation()},showMsg:function(a){var d=a.data.action;d.scriber.unbind("mouseover",this.showMsg),c[0].reinit(d.confirmBn,"Valide cette image",{position:"right"}).show(),c[1].reinit(d.recapBn,"Change d'image",{position:"bottom"}).show(),c[2].reinit(d.editBn,"Customise l'image",{position:"top"}).show(),c[3].reinit(d.closeBn,"Annuler la capture",{position:"bottom"}).show(),d.confirmBn.click({action:d},b),d.recapBn.click({action:d},b),d.editBn.click({action:d},b),d.closeBn.click({action:d},b)},endDelay:600},function(){this.confirmBn=this.scriber.find("#sb_confirm"),this.recapBn=this.scriber.find("#sb_recap"),this.editBn=this.scriber.find("#sb_edit"),this.closeBn=this.scriber.children(".close"),this.scriber.mouseover({action:this},this.showMsg)},function(){c[0].hide(),c[1].hide(),c[2].hide(),c[3].hide(),this.confirmBn.unbind("click",b),this.recapBn.unbind("click",b),this.editBn.unbind("click",b),this.closeBn.unbind("click",b)}),new MseAction("CommentSend",{dialog:gui.comment,content:gui.comment_content,btn:gui.comment_share_btn,showMsg:function(a){var d=a.data.action;d.dialog.unbind("mouseover",d.showMsg),c[0].reinit(d.btn,"Partager ou <a href='javascript:tuto.passNext();'>passe</a>",{position:"bottom"}).show(),c[1].reinit(d.content,"Tape ton commentaire",{position:"center",animate:!0}).show();var e=gui.comment_menu.children("#commentImg");e.length>0&&c[2].reinit(e,"Ton image est captur\u00e9e",{position:"left"}).show(),d.btn.click({action:d},b)},endDelay:600},function(){this.dialog.mouseover({action:this},this.showMsg)},function(){c[0].hide(),c[1].hide(),c[2].hide(),this.btn.unbind("click",b)}),new MseAction("CommentUpload",{beginDelay:600,btn:gui.comment_menu.children("#btn_upload_img"),endDelay:600},function(){gui.openComment(),c[0].reinit(this.btn,"Tu peux t\u00e9l\u00e9charger un dessin ou une photo depuis ton ordinateur",{animate:!0,position:"bottom"}).show(),this.btn.click({action:this},b);var a=this;this.timer=setTimeout(function(){a.end()},4200)},function(){this.timer&&clearTimeout(this.timer),c[0].hide(),this.btn.unbind("click",b)}),new MseAction("CloseComment",{dialog:gui.comment,close:gui.comment.children(".close"),endDelay:600},function(){c[0].reinit(this.close,"Ferme la fen\u00eatre pour continuer",{animate:!0,position:"bottom"}).show(),this.close.click({action:this},b)},function(){mse.root.pause(),c[0].hide(),this.close.unbind("click",b)}),new MseAction("Tutopages",{dialog:$("#tuto_pages"),endDelay:600},function(){gui.center.hasClass("show")||gui.center.addClass("show"),this.dialog.siblings().removeClass("show"),this.dialog.addClass("show"),this.dialog.find("a").click({action:this},b)},function(){this.dialog.removeClass("show"),gui.center.removeClass("show"),this.dialog.find("a").unbind("click",b)}),new MseAction("Finish",{},function(){msgCenter.send("Le tutoriel est termin\u00e9e, tu peux continuez votre histoire",5e3),window.quitTuto()})];tuto.addActions(g)});
