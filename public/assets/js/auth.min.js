function hideDialog(a){a.removeClass("show"),a.prop("id"),$("#conn li").removeClass("inactive")}function showSignup(){$(".dialog").removeClass("show"),$("#signup_dialog").addClass("show");var a=$("#open_signup");a.siblings(":not(.text_sep_vertical)").addClass("inactive"),a.removeClass("inactive"),addCountries($("#signupPays"))}function showLogin(){$(".dialog").removeClass("show"),$("#login_dialog").addClass("show");var a=$("#open_login");a.siblings(":not(.text_sep_vertical)").addClass("inactive"),a.removeClass("inactive")}function showChPass(){$(".dialog").removeClass("show"),$("#change_pass_dialog").addClass("show"),$("#change_pass_dialog").find("cite").text("").removeClass("alert");var a=$("#open_login");a.siblings(":not(.text_sep_vertical)").addClass("inactive"),a.removeClass("inactive")}function showLinkFb(){$(".dialog").removeClass("show"),$("#link_fb_dialog").addClass("show"),$("#link_fb_dialog").find("cite").text("").removeClass("alert");var a=$("#open_login");a.siblings(":not(.text_sep_vertical)").addClass("inactive"),a.removeClass("inactive")}function showUpdate(){$(".dialog").removeClass("show"),$("#update_dialog").addClass("show");var a=$("#user_id");a.siblings(":not(.text_sep_vertical)").addClass("inactive"),a.removeClass("inactive"),addCountries($("#updatePays"))}function addCountries(a){if(2>a.children().length&&config.countries)for(var b in config.countries)a.append('<option value="'+b+'">'+config.countries[b]+"</option>")}function monthChanged(){var a=parseInt($("#signupbMonth").val()),b=parseInt($("#signupbDay").val()),c="",d=[4,6,9,11],e=30;if(2==a)var e=28;else if(-1!=$.inArray(a,d))var e=30;else e=31;for(var f=1;e>=f;++f)c+="<option value='"+f+"'>"+f+"</option>";$("#signupbDay").html(c),e>=b&&$("#signupbDay").val(b)}function updateMonthChanged(){var a=parseInt($("#updatebMonth").val()),b=parseInt($("#updatebDay").val()),c="",d=[4,6,9,11],e=30;if(2==a)var e=28;else if(-1!=$.inArray(a,d))var e=30;else e=31;for(var f=1;e>=f;++f)c+="<option value='"+f+"'>"+f+"</option>";$("#updatebDay").html(c),e>=b&&$("#updatebDay").val(b)}(function(){function b(){function c(a){if("not_authorized"===a.status)return alert("Ton compte Facebook ne te permet pas de rejoindre notre site"),void 0;var b=fbapi.token;$.ajax({url:config.publicRoot+"base/login_fb",type:"POST",dataType:"json",data:{fb_token:b},success:function(a){if(a.valid)document.location.reload();else{switch(a.errorCode){case 10:case 11:break;case 12:showLinkFb(),a.errorMessage=""}a.errorMessage&&""!=a.errorMessage&&alert("Erreur de connexion: "+a.errorMessage),$("input[type=submit]").removeAttr("disabled")}},error:function(){alert("D\u00e9sol\u00e9, une erreur inconnue s'est produite, tu peux nous contacter: contact@encrenomade.com"),$("input[type=submit]").removeAttr("disabled")}})}$("#open_signup").click(showSignup),$("#toSignup").click(showSignup),$("#open_login").click(showLogin),$("#toLogin").click(showLogin),$("#dialog_mask").click(hideDialog),$("#user_id").click(showUpdate),$("#signupbMonth").change(monthChanged),$("#updatebMonth").change(updateMonthChanged),$(".dialog .close").unbind("click").click(function(){hideDialog($(this).parents(".dialog"))}),$(".flash-close").click(function(){var a=$(this).parent(".flash-alert");a.fadeOut(500),setTimeout(function(){a.remove()},500)});var b={type:"POST",dataType:"json",success:function(a){a.valid?document.location.reload():(a.errorType&&("mail"==a.errorType?$("#signupMail").siblings("label").addClass("alert"):"pseudo"==a.errorType&&$("#signupId").siblings("label").addClass("alert")),a.errorMessage&&alert("Erreur d'inscription: "+a.errorMessage),$("input[type=submit]").removeAttr("disabled"))},error:function(){alert("D\u00e9sol\u00e9, une erreur inconnue s'est produite, tu peux nous contacter: contact@encrenomade.com"),$("input[type=submit]").removeAttr("disabled")}};$("#signupForm").ajaxForm(b),$("#signupBtn").click(function(b){$("#signupForm").find("cite, label").removeClass("alert");var c=$("#signupId").val(),d=$("#signupPass").val(),e=$("#signupConf").val();$("#signupSex").val();var g=$("#signupbDay").val()+"/"+$("#signupbMonth").val()+"/"+$("#signupbYear").val();$("#signupBirthday").val(g);var h=$("#signupMail").val();$("#signupPays").val();var j=$("#signupCP").val(),k=$("#signupPortable").val();$("#signupNotif").val();var m=!0;""==c&&($("#signupId").siblings("cite").addClass("alert"),m=!1),""==d?($("#signupPass").siblings("cite").addClass("alert"),m=!1):6>d.length&&($("#signupPass").siblings("cite").addClass("alert"),m=!1),(""==e||e!=d)&&($("#signupConf").siblings("cite").addClass("alert"),m=!1),a.mail.test(h)||($("#signupMail").siblings("label").addClass("alert"),m=!1),""==k||a.telephone.test(k)||($("#signupPortable").siblings("cite").addClass("alert"),m=!1),""==j||a.codpos.test(j)||($("#signupCP").siblings("label").addClass("alert"),m=!1),m||b.preventDefault(),$("input[type=submit]",this).attr("disabled","disabled"),$("#signupForm").each(function(){fuel_set_csrf_token(this)})}),$("#signupForm .fb_btn").click(function(){FB.login(function(a){if("connected"==a.status){var b=a.authResponse.accessToken;FB.api("me",function(a){$("#signupId").val(a.username),$("#signupSex").val("male"==a.gender?"m":"f");var c=a.birthday.split("/");$("#signupbDay").val(c[1]),$("#signupbMonth").val(c[0]),$("#signupbYear").val(c[2]),$("#signupMail").attr("readonly","readonly").val(a.email),$("#signup_fbToken").val(b),alert("Compl\u00e8te ton formulaire d'inscription pour t'inscrire")})}else"not_authorized"===a.status?alert("Ton compte Facebook ne te permet pas de rejoindre notre site"):alert("D\u00e9sol\u00e9, une erreur inconnue s'est produite, veuilles recharger la page et r\u00e9essayer")},{scope:"publish_stream,read_stream,email,user_birthday,user_photos,photo_upload"})}),$("#loginForm .fb_btn").click(function(){fbapi.connect(c)});var b={type:"POST",dataType:"json",success:function(a){if(a.valid)return alert("F\u00e9licitation, d\u00e9sormais tu peux te connecter avec ton compte Facebook."),document.location.reload(),void 0;switch(a.errorCode){case 1:$("#linkfbPass").siblings("label").addClass("alert"),$("#linkfbId").siblings("label").addClass("alert");break;case 2:$("#linkfbId").siblings("label").addClass("alert");break;case 3:$("#linkfbPass").siblings("label").addClass("alert");break;case 10:case 11:case 13:alert(a.errorMessage),document.location.reload();break;default:alert("D\u00e9sol\u00e9, une erreur inconnue s'est produite, veuilles recharger la page et r\u00e9essayer")}$("input[type=submit]").removeAttr("disabled")},error:function(){alert("D\u00e9sol\u00e9, une erreur inconnue s'est produite, tu peux nous contacter: contact@encrenomade.com"),$("input[type=submit]").removeAttr("disabled")}};$("#linkFbForm").ajaxForm(b),$("#linkfbBtn").click(function(a){$("#linkFbForm").find("cite, label").removeClass("alert");var b=$("#linkfbId").val(),c=$("#linkfbPass").val(),d=!0;return""==b&&($("#linkfbId").siblings("label").addClass("alert"),d=!1),""==c&&($("#linkfbPass").siblings("label").addClass("alert"),d=!1),d?($("#linkfbToken").prop("value",fbapi.token),$("input[type=submit]",this).attr("disabled","disabled"),fuel_set_csrf_token($("#linkFbForm").get(0)),void 0):(a.preventDefault(),void 0)}),$("#loginForm").submit(function(a){a.preventDefault();var b=$("#loginId").val(),c=$("#loginPass").val(),d=!0;if(""==b&&($("#loginId").siblings("label").addClass("alert"),d=!1),""==c&&($("#loginPass").siblings("label").addClass("alert"),d=!1),d){$("input[type=submit]",this).attr("disabled","disabled");var e={identifiant:b,password:c};$.ajax({url:config.publicRoot+"base/login_normal",dataType:"json",type:"POST",data:e,success:function(a){a.valid?document.location.reload():(a.errorMessage&&alert("Erreur de connexion: "+a.errorMessage),$("input[type=submit]").removeAttr("disabled"))},error:function(){alert("D\u00e9sol\u00e9, une erreur inconnue s'est produite, tu peux nous contacter: contact@encrenomade.com"),$("input[type=submit]").removeAttr("disabled")}})}});var b={type:"POST",dataType:"json",success:function(a){a.valid?($("#chpass_mail").siblings("cite").text("Ton nouveau mot de passe a \u00e9t\u00e9 envoy\u00e9."),alert("Ton nouveau mot de passe a \u00e9t\u00e9 envoy\u00e9."),hideDialog($("#change_pass_dialog")),$("input[type=submit]").removeAttr("disabled")):($("#chpass_mail").siblings("cite").text(a.errorMessage).addClass("alert"),$("input[type=submit]").removeAttr("disabled"))},error:function(){$("#chpass_mail").siblings("cite").text("D\u00e9sol\u00e9, une erreur inconnue s'est produite, tu peux nous contacter: contact@encrenomade.com").addClass("alert"),$("input[type=submit]").removeAttr("disabled")}};$("#chPassForm").ajaxForm(b),$("#chPassBtn").click(function(){$("#chPassForm").find("cite, label").removeClass("alert"),$("input[type=submit]",this).attr("disabled","disabled"),fuel_set_csrf_token($("#chPassForm").get(0))});var b={type:"POST",dataType:"json",success:function(a){a.valid?document.location.reload():(a.errorType&&"password"==a.errorType&&$("#updateOldPass").siblings("label").addClass("alert"),a.errorMessage&&alert("Erreur de la mise \u00e0 jour: "+a.errorMessage),$("input[type=submit]").removeAttr("disabled"))},error:function(){alert("D\u00e9sol\u00e9, une erreur inconnue s'est produite, tu peux nous contacter: contact@encrenomade.com"),$("input[type=submit]").removeAttr("disabled")}};$("#updateForm").ajaxForm(b),$("#updateBtn").click(function(b){$("#updateForm").find("cite, label").removeClass("alert");var c=$("#updatePass").val(),d=$("#updateConf").val();$("#updateSex").val();var f=$("#updatebDay").val()+"/"+$("#updatebMonth").val()+"/"+$("#updatebYear").val();$("#updateBirthday").val(f),$("#updatePays").val();var h=$("#updateCP").val(),i=$("#updatePortable").val();$("#updateNotif").val();var k=$("#updateOldPass").val(),l=!0;""!=c&&6>c.length&&($("#updatePass").siblings("cite").addClass("alert"),l=!1),""!=d&&d!=c&&($("#updateConf").siblings("cite").addClass("alert"),l=!1),""==h||a.codpos.test(h)||($("#updateCP").siblings("label").addClass("alert"),l=!1),""==i||a.telephone.test(i)||($("#updatePortable").siblings("cite").addClass("alert"),l=!1),""==k&&($("#updateOldPass").siblings("cite").addClass("alert"),l=!1),l||b.preventDefault(),$("input[type=submit]",this).attr("disabled","disabled"),fuel_set_csrf_token($("#updateForm").get(0))}),$("#logout").click(function(){$.ajax({url:config.publicRoot+"base/logout",dataType:"json",type:"GET",success:function(a){a.valid?document.location.reload():(a.errorMessage&&alert("Erreur de d\u00e9connexion: "+a.errorMessage),$("input[type=submit]").removeAttr("disabled"))},error:function(){alert("D\u00e9sol\u00e9, une erreur inconnue s'est produite, tu peux nous contacter: contact@encrenomade.com"),$("input[type=submit]").removeAttr("disabled")}})})}var a={date:/^\d{2}\/\d{2}\/\d{4}$/,mail:/^[\w\.\_\-]+@[\w\.\_\-]+$/,telephone:/^[\d]+$/,errcode:/\d{4}/g,codpos:/^[\d]+$/};$(document).ready(b)})();